# æµ‹è¯•ç›®å½•è¯´æ˜

## ğŸ“ ç›®å½•ç»“æ„

```
tests/
â”œâ”€â”€ README.md                       # æµ‹è¯•ç›®å½•è¯´æ˜ (å½“å‰æ–‡ä»¶)
â”œâ”€â”€ conftest.py                     # pytestå…¨å±€é…ç½®
â”œâ”€â”€ conftest_inventory.py           # åº“å­˜æ¨¡å—æµ‹è¯•é…ç½®
â”œâ”€â”€ conftest_standalone.py          # ç‹¬ç«‹æµ‹è¯•é…ç½®
â”œâ”€â”€ inventory_test_utils.py         # åº“å­˜æµ‹è¯•å·¥å…·
â”œâ”€â”€ smoke_test.db                   # çƒŸé›¾æµ‹è¯•æ•°æ®åº“
â”œâ”€â”€ smoke/                          # çƒŸé›¾æµ‹è¯•ç›®å½• (å¿«é€Ÿéƒ¨ç½²éªŒè¯) âœ…
â”‚   â”œâ”€â”€ test_health.py              # ç³»ç»Ÿå¥åº·æ£€æŸ¥
â”‚   â””â”€â”€ test_basic_api.py           # åŸºç¡€APIåŠŸèƒ½éªŒè¯
â”œâ”€â”€ unit/                           # å•å…ƒæµ‹è¯•ç›®å½• (å·²å®Œæˆæ ‡å‡†åŒ–é‡ç»„ âœ…)
â”‚   â”œâ”€â”€ test_models/                # æ¨¡å‹å•å…ƒæµ‹è¯• (8ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ test_inventory_models.py
â”‚   â”‚   â”œâ”€â”€ test_inventory_architecture.py
â”‚   â”‚   â”œâ”€â”€ test_product_catalog_models.py
â”‚   â”‚   â”œâ”€â”€ test_models_sqlite.py
â”‚   â”‚   â”œâ”€â”€ test_data_models_relationships.py
â”‚   â”‚   â”œâ”€â”€ test_user_auth.py
â”‚   â”‚   â”œâ”€â”€ test_user_auth_architecture.py
â”‚   â”‚   â””â”€â”€ test_user_auth_complete.py
â”‚   â”œâ”€â”€ test_services/              # æœåŠ¡å•å…ƒæµ‹è¯• (6ä¸ªæ–‡ä»¶)
â”‚   â”‚   â”œâ”€â”€ test_member_service.py
â”‚   â”‚   â”œâ”€â”€ test_point_service.py
â”‚   â”‚   â”œâ”€â”€ test_benefit_service.py
â”‚   â”‚   â”œâ”€â”€ test_inventory_service_simple.py (âœ… Pydantic V2å·²ä¿®å¤)
â”‚   â”‚   â”œâ”€â”€ test_payment_service.py
â”‚   â”‚   â””â”€â”€ test_payment_service_fixed.py
â”‚   â”œâ”€â”€ test_utils/                 # å·¥å…·å•å…ƒæµ‹è¯• (å¾…æ‰©å±•)
â”‚   â””â”€â”€ [ç‹¬ç«‹æµ‹è¯•æ–‡ä»¶] (5ä¸ª*_standalone.pyæ–‡ä»¶)
â”‚       â”œâ”€â”€ test_inventory_management_standalone.py
â”‚       â”œâ”€â”€ test_order_management_standalone.py
â”‚       â”œâ”€â”€ test_payment_service_standalone.py
â”‚       â”œâ”€â”€ test_quality_control_standalone.py
â”‚       â”œâ”€â”€ test_shopping_cart_standalone.py
â”‚       â””â”€â”€ test_user_auth_standalone.py
â”œâ”€â”€ integration/                    # é›†æˆæµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ test_api/                   # APIé›†æˆæµ‹è¯•
â”‚   â”‚   â””â”€â”€ test_inventory_integration.py
â”‚   â”œâ”€â”€ test_auth_integration.py
â”‚   â”œâ”€â”€ test_cart_system.ps1
â”‚   â”œâ”€â”€ test_categories.py
â”‚   â”œâ”€â”€ test_inventory_api.py
â”‚   â”œâ”€â”€ test_inventory_integration_strict.py
â”‚   â”œâ”€â”€ test_inventory_management_complete.py
â”‚   â”œâ”€â”€ test_order_integration.py
â”‚   â”œâ”€â”€ test_order_integration_strict.py
â”‚   â”œâ”€â”€ test_order_management.py
â”‚   â”œâ”€â”€ test_products.py
â”‚   â”œâ”€â”€ test_product_catalog.py
â”‚   â”œâ”€â”€ test_shopping_cart.py
â”‚   â””â”€â”€ test_users.py
â””â”€â”€ e2e/                           # ç«¯åˆ°ç«¯æµ‹è¯•ç›®å½•
    â””â”€â”€ test_product_workflow_e2e.py
```

## ğŸ§ª æµ‹è¯•ç±»å‹è¯´æ˜

### çƒŸé›¾æµ‹è¯• (Smoke Tests)
ä½äº `smoke/` ç›®å½•ä¸‹ï¼Œå¿«é€ŸéªŒè¯ç³»ç»ŸåŸºæœ¬åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œä½¿ç”¨SQLiteæ–‡ä»¶æ•°æ®åº“ã€‚

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¦†ç›–èŒƒå›´ |
|----------|----------|----------|
| `smoke/test_health.py` | ç³»ç»Ÿå¥åº·æ£€æŸ¥ | APIè¿é€šæ€§ã€æ•°æ®åº“è¿æ¥ã€ç¯å¢ƒå˜é‡ |
| `smoke/test_basic_api.py` | åŸºç¡€APIéªŒè¯ | ç”¨æˆ·æ³¨å†Œã€å¥åº·æ£€æŸ¥ã€é—ç•™ç«¯ç‚¹ |

**æ‰§è¡Œå‘½ä»¤:**
```powershell
# ä½¿ç”¨pytestç›´æ¥è¿è¡Œ
pytest tests/smoke/ -v

# ä½¿ç”¨è„šæœ¬è¿è¡Œ (æ¨è)
.\scripts\smoke_test.ps1
```

### å•å…ƒæµ‹è¯• (Unit Tests)
ä½äº `unit/` ç›®å½•ä¸‹ï¼Œæµ‹è¯•å•ä¸ªå‡½æ•°ã€ç±»æˆ–æ¨¡å—çš„åŠŸèƒ½ï¼Œä½¿ç”¨Mockå’ŒSQLiteå†…å­˜æ•°æ®åº“ã€‚

#### æ¨¡å‹æµ‹è¯•
| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¦†ç›–èŒƒå›´ |
|----------|----------|----------|
| `test_models/test_inventory_models.py` | åº“å­˜æ¨¡å‹ä¸šåŠ¡é€»è¾‘ | InventoryStock, InventoryReservationç­‰ |
| `test_product_catalog_models.py` | å•†å“ç›®å½•æ¨¡å‹ | Category, Brand, Product, SKUç­‰ |

#### æœåŠ¡æµ‹è¯•
| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¦†ç›–èŒƒå›´ |
|----------|----------|----------|
| `test_services/test_inventory_service.py` | åº“å­˜ç®¡ç†æœåŠ¡é€»è¾‘ | InventoryServiceç±»æ–¹æ³• |
| `test_payment_service.py` | æ”¯ä»˜æœåŠ¡é€»è¾‘ | PaymentServiceç±»æ–¹æ³• |

#### è®¤è¯æ¨¡å—æµ‹è¯•
| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¦†ç›–èŒƒå›´ |
|----------|----------|----------|
| `test_user_auth.py` | æ ¸å¿ƒè®¤è¯åŠŸèƒ½ | ç™»å½•éªŒè¯ã€è´¦æˆ·é”å®šç­‰ |
| `test_user_auth_architecture.py` | è®¤è¯æ¶æ„åˆè§„æ€§ | æ¨¡å‹å…³ç³»ã€æ•°æ®åº“æ ‡å‡† |
| `test_user_auth_complete.py` | å®Œæ•´è®¤è¯æµ‹è¯• | User, Role, Permissionæ¨¡å‹ |
| `test_user_auth_standalone.py` | ç‹¬ç«‹è®¤è¯æµ‹è¯• | é¿å…å¾ªç¯å¯¼å…¥çš„ç‹¬ç«‹æµ‹è¯• |

## ï¿½ å¿«é€Ÿå¼€å§‹

**æµ‹è¯•ç¯å¢ƒå·¥å…·**: è¯·ä½¿ç”¨ `scripts/` ç›®å½•ä¸‹çš„æµ‹è¯•å·¥å…·
**æ ‡å‡†æµ‹è¯•æµç¨‹**: è¯·å‚è€ƒ [æµ‹è¯•æ ‡å‡†æ–‡æ¡£](../docs/standards/testing-standards.md)
**ç¯å¢ƒé…ç½®è¯´æ˜**: è¯·å‚è€ƒ [æµ‹è¯•ç¯å¢ƒé…ç½®](../docs/development/testing-setup.md)

### é›†æˆæµ‹è¯• (Integration Tests)
ä½äº `integration/` ç›®å½•ä¸‹ï¼Œæµ‹è¯•å¤šä¸ªæ¨¡å—é—´çš„åä½œå’ŒAPIç«¯ç‚¹åŠŸèƒ½ï¼Œä½¿ç”¨TestClientå’ŒçœŸå®æ•°æ®åº“ã€‚

#### APIé›†æˆæµ‹è¯•
| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¯´æ˜ |
|----------|----------|------|
| `test_categories.py` | å•†å“åˆ†ç±»APIå®Œæ•´æµç¨‹ | åˆ†ç±»CRUDæ“ä½œAPIæµ‹è¯• |
| `test_products.py` | å•†å“ç®¡ç†APIå®Œæ•´æµç¨‹ | å•†å“CRUDå’Œæœç´¢APIæµ‹è¯• |
| `test_shopping_cart.py` | è´­ç‰©è½¦APIå®Œæ•´æµç¨‹ | è´­ç‰©è½¦æ“ä½œAPIæµ‹è¯• |
| `test_users.py` | ç”¨æˆ·ç®¡ç†APIå®Œæ•´æµç¨‹ | ç”¨æˆ·æ³¨å†Œç™»å½•APIæµ‹è¯• |

#### ä¸šåŠ¡é›†æˆæµ‹è¯•
| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¯´æ˜ |
|----------|----------|------|
| `test_auth_integration.py` | è®¤è¯ç³»ç»Ÿé›†æˆæµ‹è¯• | JWTã€æƒé™ç³»ç»Ÿå®Œæ•´æµ‹è¯• |
| `test_order_management.py` | è®¢å•ç®¡ç†å®Œæ•´ä¸šåŠ¡æµç¨‹ | è®¢å•åˆ›å»ºã€çŠ¶æ€å˜æ›´ç­‰ |
| `test_inventory_management_complete.py` | åº“å­˜ç®¡ç†å®Œæ•´ä¸šåŠ¡æµç¨‹ | åº“å­˜æ“ä½œã€é¢„ç•™ã€æ‰£å‡ç­‰ |

#### ç³»ç»Ÿæµ‹è¯•è„šæœ¬
| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¯´æ˜ |
|----------|----------|------|
| `test_cart_system.ps1` | è´­ç‰©è½¦ç³»ç»Ÿæµ‹è¯• | PowerShellè„šæœ¬ï¼Œç«¯åˆ°ç«¯ä¸šåŠ¡æµç¨‹ |

### ç«¯åˆ°ç«¯æµ‹è¯• (E2E Tests)
ä½äº `e2e/` ç›®å½•ä¸‹ï¼Œæµ‹è¯•å®Œæ•´çš„ç”¨æˆ·åœºæ™¯å’Œä¸šåŠ¡æµç¨‹ã€‚

| æµ‹è¯•æ–‡ä»¶ | æµ‹è¯•å†…å®¹ | è¯´æ˜ |
|----------|----------|------|
| `test_product_workflow_e2e.py` | å•†å“ç®¡ç†å®Œæ•´å·¥ä½œæµ | ä»å•†å“åˆ›å»ºåˆ°é”€å”®çš„å®Œæ•´æµç¨‹ |

**è¿è¡Œé›†æˆæµ‹è¯•:**
```powershell
# æ–¹å¼1: é€šè¿‡å¼€å‘å·¥å…·è„šæœ¬
.\dev_tools.ps1 test-cart

# æ–¹å¼2: ç›´æ¥è¿è¡Œè„šæœ¬
.\tests\integration\test_cart_system.ps1

# æ–¹å¼3: é€šè¿‡å¼€å‘ç¯å¢ƒè„šæœ¬
. .\dev_env.ps1
test-cart
```

## ğŸš€ æµ‹è¯•ç¯å¢ƒé…ç½®

### å‰ç½®æ¡ä»¶
1. **æ•°æ®åº“æœåŠ¡**: MySQLå’ŒRedisæœåŠ¡æ­£å¸¸è¿è¡Œ
2. **APIæœåŠ¡**: FastAPIåº”ç”¨å·²å¯åŠ¨ (http://localhost:8000)
3. **æµ‹è¯•æ•°æ®**: è‡ªåŠ¨åˆ›å»ºå’Œæ¸…ç†æµ‹è¯•æ•°æ®

### ç¯å¢ƒå‡†å¤‡
```powershell
# 1. å¯åŠ¨å¼€å‘ç¯å¢ƒ
. .\dev_env.ps1

# 2. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
.\dev_tools.ps1 check-db

# 3. å¯åŠ¨APIæœåŠ¡
.\dev_tools.ps1 start-api

# 4. è¿è¡Œæµ‹è¯•
pytest  # å•å…ƒæµ‹è¯•
.\dev_tools.ps1 test-cart  # é›†æˆæµ‹è¯•
```

## ğŸ“Š æµ‹è¯•è¦†ç›–ç‡

### å½“å‰è¦†ç›–æƒ…å†µ
- **ç”¨æˆ·æ¨¡å—**: âœ… åŸºç¡€åŠŸèƒ½å·²è¦†ç›–
- **å•†å“æ¨¡å—**: âœ… CRUDæ“ä½œå·²è¦†ç›–  
- **åˆ†ç±»æ¨¡å—**: âœ… åŸºç¡€åŠŸèƒ½å·²è¦†ç›–
- **è´­ç‰©è½¦æ¨¡å—**: âœ… å®Œæ•´ä¸šåŠ¡æµç¨‹å·²è¦†ç›–

### å¾…å®Œå–„æµ‹è¯•
- **è®¢å•æ¨¡å—**: ğŸ“ å¾…æ·»åŠ 
- **æ”¯ä»˜æ¨¡å—**: ğŸ“ å¾…æ·»åŠ 
- **åº“å­˜æ¨¡å—**: ğŸ“ å¾…æ·»åŠ 
- **é€šçŸ¥æ¨¡å—**: ğŸ“ å¾…æ·»åŠ 

## ğŸ”§ æµ‹è¯•å·¥å…·å’Œé…ç½®

### pytesté…ç½® (conftest.py)
- æ•°æ®åº“æµ‹è¯•è¿æ¥é…ç½®
- æµ‹è¯•æ•°æ®å¤¹å…·(fixtures)
- æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å’Œæ¸…ç†

### é›†æˆæµ‹è¯•è„šæœ¬ç‰¹ç‚¹
- **è‡ªåŠ¨åŒ–**: æ— éœ€æ‰‹åŠ¨å¹²é¢„ï¼Œè‡ªåŠ¨æ‰§è¡Œå®Œæ•´æµç¨‹
- **æ•°æ®éš”ç¦»**: ä½¿ç”¨éšæœºæ•°æ®é¿å…æµ‹è¯•é—´å¹²æ‰°
- **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œå¤±è´¥å®šä½
- **æ¸…ç†æœºåˆ¶**: æµ‹è¯•å®Œæˆåè‡ªåŠ¨æ¸…ç†æµ‹è¯•æ•°æ®

## ğŸ“‹ æµ‹è¯•æœ€ä½³å®è·µ

### ç¼–å†™æµ‹è¯•åŸåˆ™
1. **ç‹¬ç«‹æ€§**: æ¯ä¸ªæµ‹è¯•ç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
2. **å¯é‡å¤**: å¤šæ¬¡è¿è¡Œç»“æœä¸€è‡´
3. **å¿«é€Ÿæ‰§è¡Œ**: å•å…ƒæµ‹è¯•åº”è¯¥å¿«é€Ÿå®Œæˆ
4. **æ¸…æ™°å‘½å**: æµ‹è¯•åç§°æ¸…æ¥šè¡¨è¾¾æµ‹è¯•æ„å›¾

### æµ‹è¯•æ•°æ®ç®¡ç†
1. **ä½¿ç”¨fixtures**: é€šè¿‡pytest fixturesæä¾›æµ‹è¯•æ•°æ®
2. **æ•°æ®éš”ç¦»**: æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æ•°æ®é›†
3. **æ¸…ç†æœºåˆ¶**: æµ‹è¯•å®Œæˆåæ¸…ç†æµ‹è¯•æ•°æ®
4. **çœŸå®åœºæ™¯**: æµ‹è¯•æ•°æ®å°½é‡æ¨¡æ‹ŸçœŸå®ä¸šåŠ¡åœºæ™¯

### é›†æˆæµ‹è¯•å»ºè®®
1. **å…³é”®è·¯å¾„**: é‡ç‚¹æµ‹è¯•æ ¸å¿ƒä¸šåŠ¡æµç¨‹
2. **è¾¹ç•Œæ¡ä»¶**: æµ‹è¯•å¼‚å¸¸æƒ…å†µå’Œè¾¹ç•Œå€¼
3. **æ€§èƒ½éªŒè¯**: æ£€æŸ¥å“åº”æ—¶é—´å’Œå¹¶å‘èƒ½åŠ›
4. **é”™è¯¯æ¢å¤**: éªŒè¯é”™è¯¯å¤„ç†å’Œæ¢å¤æœºåˆ¶

## ğŸ› ï¸ æ·»åŠ æ–°æµ‹è¯•

### æ·»åŠ å•å…ƒæµ‹è¯•
1. åœ¨æ ¹ç›®å½•åˆ›å»º `test_æ¨¡å—å.py` æ–‡ä»¶
2. å¯¼å…¥æ‰€éœ€çš„æµ‹è¯•ä¾èµ–å’Œè¢«æµ‹è¯•æ¨¡å—
3. ç¼–å†™æµ‹è¯•å‡½æ•°ï¼Œå‘½åä»¥ `test_` å¼€å¤´
4. ä½¿ç”¨assertionséªŒè¯é¢„æœŸç»“æœ

```python
# ç¤ºä¾‹: test_new_module.py
import pytest
from app.api.new_module import some_function

def test_some_function():
    result = some_function("input")
    assert result == "expected_output"
```

### æ·»åŠ é›†æˆæµ‹è¯•
1. åœ¨ `integration/` ç›®å½•åˆ›å»ºæµ‹è¯•è„šæœ¬
2. ä½¿ç”¨PowerShellæˆ–Pythonç¼–å†™ç«¯åˆ°ç«¯æµ‹è¯•
3. åŒ…å«å®Œæ•´çš„ä¸šåŠ¡æµç¨‹éªŒè¯
4. æ·»åŠ é”™è¯¯å¤„ç†å’Œæ¸…ç†é€»è¾‘

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¼€å‘å·¥å…·ä½¿ç”¨æŒ‡å—](../docs/development/) - å¼€å‘ç¯å¢ƒé…ç½®
- [APIæ–‡æ¡£](../docs/api/) - æ¥å£æµ‹è¯•å‚è€ƒ
- [æ¶æ„è®¾è®¡](../docs/architecture/) - ç³»ç»Ÿæ¶æ„ç†è§£
- [å¼€å‘å·¥ä½œæ€»çº²](../docs/MASTER.md) - å®Œæ•´å¼€å‘æµç¨‹
