# 冒烟测试目录

## 📋 目录说明

本目录包含冒烟测试(Smoke Testing)，用于快速验证系统的核心功能是否正常工作，是部署后的第一道质量保障。

## 📁 文件结构

```
smoke/
├── README.md                    # 本说明文档
├── test_basic_api.py           # 基础API功能测试
├── test_health.py              # 系统健康检查测试
└── test_shopping_cart_smoke.py # 购物车冒烟测试
```

## 🎯 冒烟测试目标

### 核心验证目标
- **系统启动验证**: 确认系统能够正常启动和响应
- **关键路径验证**: 验证主要业务流程的基本功能
- **依赖服务验证**: 确认数据库、缓存等依赖服务连接正常
- **API端点验证**: 验证核心API端点的可访问性和基本响应

### 快速反馈机制
- **执行时间**: 所有冒烟测试应在2分钟内完成
- **覆盖范围**: 涵盖系统的核心功能路径
- **失败快停**: 一旦发现关键问题立即停止后续测试
- **明确结果**: 提供清晰的通过/失败状态

## 🔍 当前测试模块

### 基础API测试 (test_basic_api.py)
- **API连通性**: 验证API服务器响应
- **基础端点**: 测试核心API端点可访问性
- **响应格式**: 验证API响应格式正确性
- **状态码检查**: 确认HTTP状态码符合预期

### 系统健康检查 (test_health.py)
- **服务状态**: 检查应用服务运行状态
- **数据库连接**: 验证数据库连接正常
- **缓存服务**: 检查Redis等缓存服务状态
- **系统资源**: 监控内存、CPU等资源使用情况

### 购物车冒烟测试 (test_shopping_cart_smoke.py)
- **购物车创建**: 验证购物车基本创建功能
- **商品添加**: 测试添加商品到购物车
- **数量更新**: 验证购物车商品数量更新
- **购物车查询**: 测试购物车信息查询功能

## 🚀 执行方法

### 快速执行
```powershell
# 执行所有冒烟测试
pytest tests/smoke/ -v --tb=short

# 执行特定模块测试
pytest tests/smoke/test_health.py -v

# 快速失败模式(遇到错误立即停止)
pytest tests/smoke/ -x --tb=line
```

### CI/CD集成
```powershell
# 部署后自动冒烟测试
pytest tests/smoke/ --maxfail=1 --tb=no --quiet

# 生成简化报告
pytest tests/smoke/ --tb=short --no-header -q
```

### 监控模式
```powershell
# 持续监控模式(每5分钟执行一次)
while($true) { 
    pytest tests/smoke/ -q
    Start-Sleep -Seconds 300 
}
```

## ⚡ 测试执行标准

### 性能要求
- **单个测试**: 不超过10秒执行时间
- **总体时间**: 全部冒烟测试在2分钟内完成
- **超时设置**: 每个测试设置15秒超时限制
- **并发执行**: 支持并行执行以提高效率

### 稳定性要求
- **成功率**: 冒烟测试成功率应达到99.9%
- **重试机制**: 网络相关测试支持自动重试
- **环境适应**: 支持不同环境(开发、测试、生产)
- **依赖处理**: 优雅处理外部依赖服务异常

## 🔧 测试工具和配置

### 核心测试工具
```python
# pytest配置示例
pytest_plugins = [
    "pytest_asyncio",
    "pytest_timeout", 
    "pytest_xdist"
]

# 超时配置
timeout = 15  # 15秒超时

# 重试配置
flaky_reruns = 2
```

### 环境配置
```powershell
# 环境变量设置
$env:SMOKE_TEST_MODE = "true"
$env:API_TIMEOUT = "10"
$env:DB_TIMEOUT = "5"
```

### 监控和报告
- **测试结果**: JUnit XML格式输出
- **执行时间**: 详细的执行时间统计
- **失败日志**: 简洁的失败原因记录
- **趋势分析**: 执行时间和成功率趋势

## 📊 冒烟测试检查清单

### 系统级检查
- [ ] 应用程序启动成功
- [ ] 数据库连接正常
- [ ] 缓存服务可用
- [ ] 日志系统工作
- [ ] 配置文件加载正确

### API级检查
- [ ] 健康检查端点响应
- [ ] 认证服务可用
- [ ] 核心业务API响应
- [ ] API响应时间正常
- [ ] 错误处理机制工作

### 业务级检查
- [ ] 用户注册/登录功能
- [ ] 商品查询功能
- [ ] 购物车操作功能
- [ ] 订单创建功能
- [ ] 支付接口连通

## 🚨 告警和通知

### 失败处理
- **立即通知**: 冒烟测试失败时立即通知开发团队
- **自动回滚**: 严重问题时触发自动回滚机制
- **问题跟踪**: 自动创建问题跟踪记录
- **修复验证**: 修复后自动重新执行冒烟测试

### 监控集成
- **Slack通知**: 测试结果自动发送到团队频道
- **邮件报告**: 每日冒烟测试汇总报告
- **仪表板**: 实时冒烟测试状态监控
- **历史记录**: 冒烟测试执行历史和趋势分析

## 📚 相关文档

- **[测试标准文档](../../docs/standards/testing-standards.md)** - 冒烟测试规范
- **[部署指南](../../docs/operations/deployment-guide.md)** - 部署后验证流程
- **[监控配置](../../docs/operations/monitoring-setup.md)** - 系统监控配置