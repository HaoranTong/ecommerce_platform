# æµ‹è¯•ç¯å¢ƒé…ç½®æŒ‡å—

ğŸ“ **æ–‡æ¡£è¯´æ˜**ï¼š
- **å†…å®¹**ï¼šè¯¦ç»†çš„æµ‹è¯•ç¯å¢ƒé…ç½®ã€å·¥å…·ä½¿ç”¨ã€æ•…éšœæ’é™¤æŒ‡å—
- **ä½¿ç”¨è€…**ï¼šå¼€å‘äººå‘˜ã€æµ‹è¯•äººå‘˜
- **æ›´æ–°é¢‘ç‡**ï¼šæµ‹è¯•å·¥å…·æˆ–ç¯å¢ƒé…ç½®å˜æ›´æ—¶æ›´æ–°
- **å…³è”æ–‡æ¡£**ï¼š[æµ‹è¯•æ ‡å‡†](../standards/testing-standards.md)ã€[å·¥ä½œæµç¨‹](../standards/workflow.md)

## ğŸ¯ æµ‹è¯•ç¯å¢ƒæ¶æ„

### æµ‹è¯•ç±»å‹ä¸ç¯å¢ƒé…ç½®

| æµ‹è¯•ç±»å‹ | æ•°æ®åº“é…ç½® | éš”ç¦»çº§åˆ« | æ‰§è¡Œæ—¶é—´ | å¤–éƒ¨ä¾èµ– |
|---------|-----------|---------|---------|---------|
| **å•å…ƒæµ‹è¯•** | SQLiteå†…å­˜ | å‡½æ•°çº§åˆ« | ç§’çº§ | æ—  |
| **çƒŸé›¾æµ‹è¯•** | SQLiteæ–‡ä»¶ | æ¨¡å—çº§åˆ« | åˆ†é’Ÿçº§ | æ—  |
| **é›†æˆæµ‹è¯•** | MySQL Docker | ä¼šè¯çº§åˆ« | åˆ†é’Ÿçº§ | Docker |
| **E2Eæµ‹è¯•** | MySQL Docker | ä¼šè¯çº§åˆ« | åˆ†é’Ÿçº§ | Docker |

### ç¯å¢ƒéš”ç¦»åŸåˆ™
- **æ•°æ®éš”ç¦»**ï¼šä¸åŒæµ‹è¯•ç±»å‹ä½¿ç”¨ä¸åŒæ•°æ®åº“
- **è¿›ç¨‹éš”ç¦»**ï¼šæ¯ä¸ªæµ‹è¯•å‡½æ•°ç‹¬ç«‹çš„æ•°æ®åº“ä¼šè¯
- **é…ç½®éš”ç¦»**ï¼šç‹¬ç«‹çš„æµ‹è¯•é…ç½®æ–‡ä»¶å’Œç¯å¢ƒå˜é‡

## ğŸ”§ æµ‹è¯•å·¥å…·è¯¦ç»†ä½¿ç”¨è¯´æ˜

### 1. check_test_env.ps1 - å¿«é€Ÿç¯å¢ƒæ£€æŸ¥

#### åŠŸèƒ½è¯´æ˜
30ç§’å¿«é€Ÿæ£€æŸ¥æµ‹è¯•ç¯å¢ƒæ˜¯å¦å°±ç»ªï¼Œ**å¿…é¡»åœ¨ä»»ä½•æµ‹è¯•å‰æ‰§è¡Œ**ã€‚

#### æ£€æŸ¥é¡¹ç›®
```powershell
âœ… Pythonè™šæ‹Ÿç¯å¢ƒçŠ¶æ€          # éªŒè¯.venvç¯å¢ƒæ¿€æ´»
âœ… æµ‹è¯•ä¾èµ–åŒ…å®Œæ•´æ€§            # pytest, sqlalchemy, fastapiç­‰
âœ… æµ‹è¯•ç›®å½•ç»“æ„               # tests/unit/, tests/integration/ç­‰
âœ… pytesté…ç½®æ–‡ä»¶            # tests/conftest.pyå­˜åœ¨æ€§
âœ… SQLiteæ•°æ®åº“è¿æ¥           # å†…å­˜å’Œæ–‡ä»¶æ•°æ®åº“æµ‹è¯•
âœ… Dockerç¯å¢ƒ (å¯é€‰)          # é›†æˆæµ‹è¯•éœ€è¦
```

#### ä½¿ç”¨ç¤ºä¾‹
```powershell
# åŸºæœ¬ä½¿ç”¨
.\scripts\check_test_env.ps1

# è¾“å‡ºç¤ºä¾‹ (æˆåŠŸ)
ğŸ” å¿«é€Ÿæµ‹è¯•ç¯å¢ƒæ£€æŸ¥
========================================
âœ… Pythonè™šæ‹Ÿç¯å¢ƒ
âœ… PythonåŒ…: pytest
âœ… PythonåŒ…: sqlalchemy
âœ… PythonåŒ…: fastapi
âœ… PythonåŒ…: httpx
âœ… æµ‹è¯•ç›®å½•: tests
âœ… æµ‹è¯•ç›®å½•: tests/unit
âœ… æµ‹è¯•ç›®å½•: tests/integration
âœ… æµ‹è¯•ç›®å½•: tests/e2e
âœ… pytesté…ç½®æ–‡ä»¶
âœ… SQLiteæ•°æ®åº“
âœ… Docker (é›†æˆæµ‹è¯•å¯é€‰)

ğŸ‰ æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼æµ‹è¯•ç¯å¢ƒå°±ç»ªã€‚
æ‚¨å¯ä»¥è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼€å§‹æµ‹è¯•:
  pytest tests/unit/ -v           # å•å…ƒæµ‹è¯•
  pytest tests/integration/ -v    # é›†æˆæµ‹è¯•
  pytest tests/ -v                # å…¨éƒ¨æµ‹è¯•
```

### 2. setup_test_env.ps1 - æ ‡å‡†æµ‹è¯•æµç¨‹

#### åŠŸèƒ½è¯´æ˜
å®Œæ•´çš„æµ‹è¯•ç¯å¢ƒè®¾ç½®ã€éªŒè¯ã€æ‰§è¡Œã€æ¸…ç†æµç¨‹ã€‚

#### å‚æ•°è¯¦è§£
```powershell
-TestType <ç±»å‹>    # unit|smoke|integration|all
-SetupOnly         # ä»…è®¾ç½®ç¯å¢ƒï¼Œä¸è¿è¡Œæµ‹è¯•
-SkipValidation    # è·³è¿‡ç¯å¢ƒéªŒè¯ (ä¸æ¨è)
```

#### ä½¿ç”¨åœºæ™¯

**åœºæ™¯1ï¼šæ ‡å‡†å•å…ƒæµ‹è¯•** 
```powershell
.\scripts\setup_test_env.ps1 -TestType unit

# æ‰§è¡Œæµç¨‹ï¼š
# 1. æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒ
# 2. è¿è¡Œç¯å¢ƒéªŒè¯
# 3. è®¾ç½®SQLiteå†…å­˜æ•°æ®åº“
# 4. æ‰§è¡Œå•å…ƒæµ‹è¯• (pytest tests/unit/ -v)
# 5. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
```

**åœºæ™¯2ï¼šé›†æˆæµ‹è¯•ç¯å¢ƒå‡†å¤‡**
```powershell
.\scripts\setup_test_env.ps1 -TestType integration -SetupOnly

# æ‰§è¡Œæµç¨‹ï¼š
# 1. æ£€æŸ¥Dockerç¯å¢ƒ
# 2. å¯åŠ¨MySQLæµ‹è¯•å®¹å™¨
# 3. ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–
# 4. éªŒè¯æ•°æ®åº“è¿æ¥
# 5. ç¯å¢ƒå‡†å¤‡å®Œæˆ (ä¸è¿è¡Œæµ‹è¯•)
```

**åœºæ™¯3ï¼šå®Œæ•´é›†æˆæµ‹è¯•**
```powershell
.\scripts\setup_test_env.ps1 -TestType integration

# æ‰§è¡Œæµç¨‹ï¼š
# 1-5. åŒä¸Šç¯å¢ƒå‡†å¤‡
# 6. æ‰§è¡Œé›†æˆæµ‹è¯• (pytest tests/integration/ -v)
# 7. æ¸…ç†Dockerå®¹å™¨
# 8. ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
```

**åœºæ™¯4ï¼šå®Œæ•´æµ‹è¯•å¥—ä»¶**
```powershell
.\scripts\setup_test_env.ps1 -TestType all

# æ‰§è¡Œæµç¨‹ï¼š
# 1. å‡†å¤‡æ‰€æœ‰æµ‹è¯•ç¯å¢ƒ
# 2. ä¾æ¬¡æ‰§è¡Œï¼šå•å…ƒæµ‹è¯• â†’ é›†æˆæµ‹è¯• â†’ E2Eæµ‹è¯•
# 3. æ¸…ç†æ‰€æœ‰ç¯å¢ƒ
# 4. ç”Ÿæˆç»¼åˆæµ‹è¯•æŠ¥å‘Š
```

### 3. validate_test_config.py - æ·±åº¦é…ç½®éªŒè¯

#### åŠŸèƒ½è¯´æ˜
7æ­¥è¯¦ç»†éªŒè¯ï¼Œæ·±åº¦è¯Šæ–­æµ‹è¯•é…ç½®é—®é¢˜ï¼Œç”¨äºæ•…éšœæ’æŸ¥ã€‚

#### éªŒè¯æ­¥éª¤
```python
1. Pythonç¯å¢ƒéªŒè¯       # Pythonç‰ˆæœ¬ã€è™šæ‹Ÿç¯å¢ƒçŠ¶æ€
2. æµ‹è¯•ä¾èµ–åŒ…éªŒè¯       # æ‰€æœ‰å¿…éœ€åŒ…çš„å®‰è£…çŠ¶æ€
3. åº”ç”¨æ¨¡å—å¯¼å…¥éªŒè¯     # æ ¸å¿ƒæ¨¡å—å¯¼å…¥èƒ½åŠ›æµ‹è¯•
4. å•å…ƒæµ‹è¯•é…ç½®éªŒè¯     # SQLiteå†…å­˜æ•°æ®åº“åŠŸèƒ½æµ‹è¯•
5. çƒŸé›¾æµ‹è¯•é…ç½®éªŒè¯     # SQLiteæ–‡ä»¶æ•°æ®åº“åŠŸèƒ½æµ‹è¯•
6. é›†æˆæµ‹è¯•é…ç½®éªŒè¯     # MySQLè¿æ¥æµ‹è¯• (å¯é€‰)
7. pytesté…ç½®éªŒè¯      # pytesté…ç½®æ–‡ä»¶å’Œç›®å½•ç»“æ„
```

#### ä½¿ç”¨ç¤ºä¾‹
```powershell
python scripts/validate_test_config.py

# è¾“å‡ºç¤ºä¾‹ (éƒ¨åˆ†)
ğŸ” æµ‹è¯•ç¯å¢ƒé…ç½®éªŒè¯å¼€å§‹
==================================================
=== Pythonç¯å¢ƒéªŒè¯ ===
âœ… Pythonç‰ˆæœ¬: 3.11.9
âœ… è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»: E:\ecommerce_platform\.venv
âœ… é¡¹ç›®æ ¹ç›®å½•: E:\ecommerce_platform

=== æµ‹è¯•ä¾èµ–åŒ…éªŒè¯ ===
âœ… pytest - å·²å®‰è£…
âœ… sqlalchemy - å·²å®‰è£…
âœ… fastapi - å·²å®‰è£…

=== å•å…ƒæµ‹è¯•é…ç½®éªŒè¯ ===
âœ… SQLiteå†…å­˜æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ… æ•°æ®åº“ä¼šè¯åˆ›å»ºæˆåŠŸ

ğŸ“Š éªŒè¯ç»“æœ: 7ä¸ªé€šè¿‡, 0ä¸ªå¤±è´¥
ğŸ‰ æ‰€æœ‰æµ‹è¯•ç¯å¢ƒé…ç½®éªŒè¯é€šè¿‡ï¼å¯ä»¥å¼€å§‹è¿è¡Œæµ‹è¯•ã€‚
```

## ğŸš¨ æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### é—®é¢˜1ï¼šè™šæ‹Ÿç¯å¢ƒæœªæ¿€æ´»
```
âŒ Pythonè™šæ‹Ÿç¯å¢ƒ
   å½“å‰Python: C:\Python39\python.exe
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
.venv\Scripts\Activate.ps1

# éªŒè¯æ¿€æ´»
python -c "import sys; print(sys.prefix)"
```

#### é—®é¢˜2ï¼šä¾èµ–åŒ…ç¼ºå¤±
```
âŒ PythonåŒ…: pytest - æœªå®‰è£…
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# å®‰è£…æµ‹è¯•ä¾èµ–
pip install pytest pytest-asyncio pytest-cov

# æˆ–å®‰è£…å®Œæ•´ä¾èµ–
pip install -r requirements.txt
```

#### é—®é¢˜3ï¼šæµ‹è¯•ç›®å½•ç»“æ„é—®é¢˜
```
âŒ æµ‹è¯•ç›®å½•: tests/unit
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# æ£€æŸ¥ç›®å½•ç»“æ„
ls tests/

# åˆ›å»ºç¼ºå¤±ç›®å½•
mkdir tests/unit, tests/integration, tests/e2e
```

#### é—®é¢˜4ï¼šDockerç¯å¢ƒé—®é¢˜
```
âš ï¸ MySQLæµ‹è¯•æ•°æ®åº“ä¸å¯ç”¨: Can't connect to MySQL
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# æ£€æŸ¥DockerçŠ¶æ€
docker --version

# å¯åŠ¨Docker Desktop
# ç„¶åé‡æ–°è¿è¡Œæµ‹è¯•
.\scripts\setup_test_env.ps1 -TestType integration
```

#### é—®é¢˜5ï¼šSQLAlchemyæ¨¡å‹å…³ç³»é”™è¯¯
```
âŒ One or more mappers failed to initialize - can't proceed
```
**è§£å†³æ–¹æ¡ˆ**ï¼š
```powershell
# è¿è¡Œè¯¦ç»†éªŒè¯
python scripts/validate_test_config.py

# æ£€æŸ¥æ¨¡å‹å¯¼å…¥
python -c "from app.modules.user_auth.models import User; print('OK')"

# é‡æ–°ç”Ÿæˆæ•°æ®åº“
rm tests/smoke_test.db
.\scripts\setup_test_env.ps1 -TestType smoke
```

### ç¯å¢ƒé‡ç½®æ­¥éª¤

**å®Œå…¨é‡ç½®æµ‹è¯•ç¯å¢ƒ**ï¼š
```powershell
# ç¬¬ä¸€æ­¥ï¼šæ¸…ç†æµ‹è¯•æ•°æ®åº“æ–‡ä»¶
Remove-Item tests/smoke_test.db -Force -ErrorAction SilentlyContinue

# ç¬¬äºŒæ­¥ï¼šåœæ­¢å¹¶æ¸…ç†Dockerå®¹å™¨
docker stop mysql_test 2>$null
docker rm mysql_test 2>$null

# ç¬¬ä¸‰æ­¥ï¼šé‡æ–°éªŒè¯ç¯å¢ƒ
.\scripts\check_test_env.ps1

# ç¬¬å››æ­¥ï¼šé‡æ–°è¿è¡Œæµ‹è¯•
.\scripts\setup_test_env.ps1 -TestType unit
```

## ğŸ“Š æµ‹è¯•æ‰§è¡Œæœ€ä½³å®è·µ

### å¼€å‘é˜¶æ®µæµ‹è¯•ç­–ç•¥
```powershell
# å¼€å‘è¿‡ç¨‹ä¸­ï¼šé¢‘ç¹è¿è¡Œå•å…ƒæµ‹è¯•
.\scripts\setup_test_env.ps1 -TestType unit

# åŠŸèƒ½å®Œæˆåï¼šè¿è¡Œé›†æˆæµ‹è¯•
.\scripts\setup_test_env.ps1 -TestType integration

# æäº¤å‰ï¼šè¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
.\scripts\setup_test_env.ps1 -TestType all
```

### æŒç»­é›†æˆç¯å¢ƒé…ç½®
```yaml
# CI/CDç®¡é“ä¸­çš„æµ‹è¯•æ­¥éª¤
steps:
  - name: Setup Test Environment
    run: .\scripts\check_test_env.ps1
    
  - name: Run Unit Tests
    run: .\scripts\setup_test_env.ps1 -TestType unit
    
  - name: Run Integration Tests
    run: .\scripts\setup_test_env.ps1 -TestType integration
```

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
1. **å•å…ƒæµ‹è¯•ä¼˜å…ˆ**ï¼šå¼€å‘æ—¶ä¸»è¦è¿è¡Œå•å…ƒæµ‹è¯•ï¼Œé€Ÿåº¦æœ€å¿«
2. **é›†æˆæµ‹è¯•å®šæœŸè¿è¡Œ**ï¼šæ¯æ—¥æˆ–æ¯æ¬¡åŠŸèƒ½å®Œæˆåè¿è¡Œ
3. **Dockerå®¹å™¨å¤ç”¨**ï¼šé›†æˆæµ‹è¯•æ—¶ä½¿ç”¨ `-SetupOnly` å‡†å¤‡ç¯å¢ƒï¼Œç„¶åæ‰‹åŠ¨è¿è¡Œæµ‹è¯•
4. **å¹¶è¡Œæµ‹è¯•**ï¼šä½¿ç”¨ `pytest-xdist` è¿›è¡Œå¹¶è¡Œæµ‹è¯•æ‰§è¡Œ

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æµ‹è¯•æ ‡å‡†æ–‡æ¡£](../standards/testing-standards.md) - æµ‹è¯•è§„èŒƒå’Œæ ‡å‡†æµç¨‹
- [å·¥ä½œæµç¨‹æ–‡æ¡£](../standards/workflow.md) - å¼€å‘å·¥ä½œæµç¨‹ä¸­çš„æµ‹è¯•ç¯èŠ‚
- [MASTERæ–‡æ¡£](../../MASTER.md) - å¼ºåˆ¶æ€§æ£€æŸ¥ç‚¹å’Œè§„èŒƒè¦æ±‚