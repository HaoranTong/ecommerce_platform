# åº“å­˜ç®¡ç†æ¨¡å— (Inventory Management Module)

<!--
æ–‡ä»¶åï¼šREADME.md
æ–‡ä»¶è·¯å¾„ï¼šdocs/design/modules/inventory-management/README.md
æ–‡æ¡£ç±»å‹ï¼šæ¨¡å—å¿«é€ŸæŒ‡å—
æ¨¡å—åç§°ï¼šåº“å­˜ç®¡ç†æ¨¡å— (Inventory Management Module)
æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0.0
åˆ›å»ºæ—¶é—´ï¼š2025-09-15
æœ€åä¿®æ”¹ï¼š2025-09-15
ç»´æŠ¤äººå‘˜ï¼šäº§å“ç»ç†/å¼€å‘å·¥ç¨‹å¸ˆ
æ–‡æ¡£çŠ¶æ€ï¼šæ­£å¼ç‰ˆæœ¬

æ–‡æ¡£ç”¨é€”ï¼š
- æä¾›åº“å­˜ç®¡ç†æ¨¡å—çš„å¿«é€Ÿå…¥é—¨æŒ‡å—
- åŒ…å«ç¯å¢ƒé…ç½®ã€å®‰è£…éƒ¨ç½²å’ŒåŸºæœ¬ä½¿ç”¨æ–¹æ³•
- ä¸ºå¼€å‘è€…æä¾›å¿«é€Ÿä¸Šæ‰‹çš„å‚è€ƒèµ„æ–™

ç›¸å…³æ–‡æ¡£ï¼š
- è¯¦ç»†éœ€æ±‚ï¼šrequirements.md
- ç³»ç»Ÿè®¾è®¡ï¼šdesign.md
- æŠ€æœ¯å®ç°ï¼šimplementation.md
- APIè¯´æ˜ï¼šapi-implementation.md
-->

## æ¨¡å—æ¦‚è¿°

åº“å­˜ç®¡ç†æ¨¡å—æ˜¯ç”µå•†å¹³å°çš„æ ¸å¿ƒåŸºç¡€æ¨¡å—ï¼Œè´Ÿè´£å•†å“åº“å­˜çš„å…¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ŒåŒ…æ‹¬åº“å­˜æŸ¥è¯¢ã€é¢„ç•™ã€æ‰£å‡ã€é‡Šæ”¾ä»¥åŠåº“å­˜ç›‘æ§ç­‰åŠŸèƒ½ã€‚è¯¥æ¨¡å—ç¡®ä¿å¹³å°å•†å“åº“å­˜æ•°æ®çš„å‡†ç¡®æ€§å’Œä¸€è‡´æ€§ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯ä¸‹çš„åº“å­˜æ“ä½œã€‚

## æ ¸å¿ƒåŠŸèƒ½

### ğŸ” åº“å­˜æŸ¥è¯¢
- å®æ—¶åº“å­˜æŸ¥è¯¢
- æ‰¹é‡åº“å­˜æŸ¥è¯¢
- åº“å­˜å†å²è®°å½•æŸ¥è¯¢
- åº“å­˜å˜æ›´æ—¥å¿—

### ğŸ“¦ åº“å­˜ç®¡ç†
- åº“å­˜å…¥åº“/å‡ºåº“
- åº“å­˜é¢„ç•™/é‡Šæ”¾
- åº“å­˜æ‰£å‡/å›é€€
- åº“å­˜è°ƒæ•´/ç›˜ç‚¹

### ğŸ“Š åº“å­˜ç›‘æ§
- åº“å­˜é¢„è­¦æœºåˆ¶
- ä½åº“å­˜é€šçŸ¥
- åº“å­˜ç»Ÿè®¡æŠ¥è¡¨
- å®æ—¶åº“å­˜ç›‘æ§

### ğŸ” å®‰å…¨æ§åˆ¶
- æ“ä½œæƒé™æ§åˆ¶
- å®¡è®¡æ—¥å¿—è®°å½•
- æ•°æ®å®Œæ•´æ€§ä¿æŠ¤
- å¹¶å‘å®‰å…¨æ§åˆ¶

## æŠ€æœ¯æ¶æ„

### æŠ€æœ¯æ ˆ
- **Webæ¡†æ¶**: FastAPI
- **ORM**: SQLAlchemy 2.0
- **æ•°æ®åº“**: PostgreSQL (ä¸») + Redis (ç¼“å­˜)
- **æ¶ˆæ¯é˜Ÿåˆ—**: Redis Streams
- **ç›‘æ§**: Prometheus + Grafana
- **æ—¥å¿—**: ç»“æ„åŒ–æ—¥å¿— + ELK Stack

### æ¶æ„å±‚æ¬¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   API Layer     â”‚ â† FastAPIè·¯ç”±å’Œä¸­é—´ä»¶
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Service Layer   â”‚ â† ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Repository Layer â”‚ â† æ•°æ®è®¿é—®å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Data Layer    â”‚ â† PostgreSQL + Redis
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.11+
- PostgreSQL 14+
- Redis 7.0+
- Docker 20.10+ (å¯é€‰)

### å®‰è£…ä¾èµ–
```bash
# å®‰è£…Pythonä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æ•°æ®åº“æœåŠ¡ (ä½¿ç”¨Docker)
docker-compose up -d postgres redis
```

### æ•°æ®åº“åˆå§‹åŒ–
```bash
# è¿è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head

# åˆå§‹åŒ–åŸºç¡€æ•°æ®
python scripts/init_inventory_data.py
```

### å¯åŠ¨æœåŠ¡
```bash
# å¼€å‘æ¨¡å¼å¯åŠ¨
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload

# æˆ–ä½¿ç”¨å¼€å‘è„šæœ¬
./start.ps1
```

## APIä½¿ç”¨ç¤ºä¾‹

### æŸ¥è¯¢åº“å­˜
```python
import httpx

# æŸ¥è¯¢å•ä¸ªSKUåº“å­˜
response = httpx.get("http://localhost:8000/api/v1/inventory-management/SKU001")
print(response.json())

# æ‰¹é‡æŸ¥è¯¢åº“å­˜
response = httpx.post(
    "http://localhost:8000/api/v1/inventory-management/batch-query",
    json={"sku_codes": ["SKU001", "SKU002", "SKU003"]}
)
print(response.json())
```

### åº“å­˜é¢„ç•™
```python
# é¢„ç•™åº“å­˜
response = httpx.post(
    "http://localhost:8000/api/v1/inventory-management/reserve",
    json={
        "sku_code": "SKU001",
        "quantity": 10,
        "business_type": "ORDER",
        "business_id": "ORDER_12345",
        "expires_at": "2024-01-15T10:00:00Z"
    }
)
print(response.json())
```

### åº“å­˜æ‰£å‡
```python
# ç¡®è®¤æ‰£å‡åº“å­˜
response = httpx.post(
    "http://localhost:8000/api/v1/inventory-management/deduct",
    json={
        "sku_code": "SKU001",
        "quantity": 5,
        "business_type": "ORDER",
        "business_id": "ORDER_12345"
    }
)
print(response.json())
```

## å¼€å‘æŒ‡å—

### é¡¹ç›®ç»“æ„
```
app/modules/inventory_management/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ router.py              # APIè·¯ç”±
â”œâ”€â”€ service.py             # ä¸šåŠ¡æœåŠ¡
â”œâ”€â”€ repository.py          # æ•°æ®ä»“å‚¨
â”œâ”€â”€ models.py             # æ•°æ®æ¨¡å‹
â”œâ”€â”€ schemas.py            # è¯·æ±‚/å“åº”æ¨¡å¼
â”œâ”€â”€ exceptions.py         # è‡ªå®šä¹‰å¼‚å¸¸
â”œâ”€â”€ constants.py          # å¸¸é‡å®šä¹‰
â””â”€â”€ utils.py              # å·¥å…·å‡½æ•°
```

### ä»£ç è§„èŒƒ
- éµå¾ª PEP 8 ä»£ç é£æ ¼
- ä½¿ç”¨ Type Hints è¿›è¡Œç±»å‹æ³¨è§£
- ç¼–å†™å®Œæ•´çš„å•å…ƒæµ‹è¯•
- æ·»åŠ è¯¦ç»†çš„æ–‡æ¡£å­—ç¬¦ä¸²

### æµ‹è¯•è¿è¡Œ
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
pytest tests/

# è¿è¡Œåº“å­˜æ¨¡å—æµ‹è¯•
pytest tests/test_inventory_management.py -v

# è¿è¡Œè¦†ç›–ç‡æµ‹è¯•
pytest --cov=app.modules.inventory_management tests/
```

## é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡
```bash
# æ•°æ®åº“é…ç½®
DATABASE_URL=postgresql://user:password@localhost:5432/ecommerce
REDIS_URL=redis://localhost:6379/0

# åº“å­˜é…ç½®
INVENTORY_CACHE_TTL=300
INVENTORY_BATCH_SIZE=1000
INVENTORY_RESERVATION_TTL=1800

# ç›‘æ§é…ç½®
ENABLE_METRICS=true
METRICS_PORT=8001
```

### æ€§èƒ½è°ƒä¼˜
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- Redis ç¼“å­˜ç­–ç•¥
- è¿æ¥æ± é…ç½®
- æ‰¹é‡æ“ä½œä¼˜åŒ–

## ç›‘æ§å’Œè¿ç»´

### å¥åº·æ£€æŸ¥
```bash
# æ£€æŸ¥æœåŠ¡çŠ¶æ€
curl http://localhost:8000/health

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
curl http://localhost:8000/health/database

# æ£€æŸ¥Redisè¿æ¥
curl http://localhost:8000/health/redis
```

### å…³é”®æŒ‡æ ‡
- åº“å­˜æŸ¥è¯¢QPS
- åº“å­˜æ“ä½œæˆåŠŸç‡
- æ•°æ®åº“å“åº”æ—¶é—´
- ç¼“å­˜å‘½ä¸­ç‡
- é”™è¯¯ç‡ç»Ÿè®¡

### æ—¥å¿—ç›‘æ§
```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f logs/inventory.log

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
grep "ERROR" logs/inventory.log | tail -20
```

## å¸¸è§é—®é¢˜

### Q: å¦‚ä½•å¤„ç†åº“å­˜ä¸è¶³çš„æƒ…å†µï¼Ÿ
A: ç³»ç»Ÿä¼šæŠ›å‡º `InsufficientInventoryError` å¼‚å¸¸ï¼Œå‰ç«¯éœ€è¦æ•è·å¹¶æç¤ºç”¨æˆ·ã€‚

### Q: é¢„ç•™åº“å­˜è¿‡æœŸåä¼šè‡ªåŠ¨é‡Šæ”¾å—ï¼Ÿ
A: æ˜¯çš„ï¼Œç³»ç»Ÿæœ‰å®šæ—¶ä»»åŠ¡ä¼šæ¸…ç†è¿‡æœŸçš„é¢„ç•™åº“å­˜ã€‚

### Q: æ”¯æŒåˆ†å¸ƒå¼ç¯å¢ƒä¸‹çš„åº“å­˜åŒæ­¥å—ï¼Ÿ
A: æ”¯æŒï¼Œä½¿ç”¨Redisåˆ†å¸ƒå¼é”ç¡®ä¿åº“å­˜æ“ä½œçš„åŸå­æ€§ã€‚

### Q: å¦‚ä½•è¿›è¡Œåº“å­˜ç›˜ç‚¹ï¼Ÿ
A: å¯ä»¥ä½¿ç”¨åº“å­˜è°ƒæ•´æ¥å£ï¼Œæ”¯æŒæ‰¹é‡è°ƒæ•´å’Œå®¡è®¡è®°å½•ã€‚

## ç›¸å…³æ–‡æ¡£

- [éœ€æ±‚è§„æ ¼è¯´æ˜ä¹¦](./requirements.md) - è¯¦ç»†çš„åŠŸèƒ½éœ€æ±‚å’Œä¸šåŠ¡è§„åˆ™
- [ç³»ç»Ÿè®¾è®¡æ–‡æ¡£](./design.md) - æ¶æ„è®¾è®¡å’ŒæŠ€æœ¯é€‰å‹
- [å®ç°æŒ‡å—](./implementation.md) - å…·ä½“çš„å®ç°ç»†èŠ‚å’Œä»£ç ç»“æ„  
- [APIå®ç°æ–‡æ¡£](./api-implementation.md) - è¯¦ç»†çš„APIç«¯ç‚¹å’Œä½¿ç”¨è¯´æ˜
- [æ¨¡å—æ¦‚è§ˆ](./overview.md) - æ¨¡å—çš„æ•´ä½“ä»‹ç»
- [APIè§„æ ¼](./api-spec.md) - APIæ¥å£è§„èŒƒ

## ç‰ˆæœ¬å†å²

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´è¯´æ˜ |
|------|------|----------|
| v1.0.0 | 2024-01-10 | åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€åº“å­˜ç®¡ç†åŠŸèƒ½ |
| v1.1.0 | 2024-01-15 | æ·»åŠ æ‰¹é‡æ“ä½œå’Œæ€§èƒ½ä¼˜åŒ– |
| v1.2.0 | 2024-01-20 | å¢åŠ ç›‘æ§å’Œå‘Šè­¦åŠŸèƒ½ |

## è´¡çŒ®æŒ‡å—

1. Fork é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/inventory-enhancement`)
3. æäº¤æ›´æ”¹ (`git commit -am 'Add some feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/inventory-enhancement`)
5. åˆ›å»º Pull Request

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](../../../LICENSE) æ–‡ä»¶ã€‚
