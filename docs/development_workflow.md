# 电商平台开发工作流程规范

## 1. 功能模块开发标准流程

### 1.1 需求分析阶段
- [ ] 明确功能需求和业务逻辑
- [ ] 定义API接口规范
- [ ] 确定数据模型结构
- [ ] 识别依赖关系和集成点

### 1.2 设计阶段
- [ ] 设计数据库表结构
- [ ] 设计API接口文档
- [ ] 设计错误处理策略
- [ ] 设计测试用例

### 1.3 实现阶段
- [ ] 创建数据模型（SQLAlchemy）
- [ ] 创建Pydantic schemas
- [ ] 实现业务逻辑
- [ ] 实现API路由
- [ ] 添加错误处理

### 1.4 测试阶段
- [ ] 单元测试
- [ ] 集成测试
- [ ] API测试
- [ ] 端到端测试

### 1.5 文档阶段
- [ ] 更新API文档
- [ ] 更新数据库文档
- [ ] 记录已知问题
- [ ] 更新用户手册

## 2. 购物车功能完整需求

### 2.1 核心功能
1. **添加商品到购物车**
   - 验证商品存在
   - 验证库存充足
   - 支持数量累加
   - 返回完整商品信息

2. **查看购物车**
   - 显示所有商品详情
   - 计算小计和总计
   - 显示商品图片和描述

3. **更新购物车商品数量**
   - 验证新数量合法性
   - 验证库存充足
   - 更新小计

4. **删除购物车商品**
   - 单个商品删除
   - 清空购物车

### 2.2 数据结构要求
- 商品信息必须包含：id, name, description, price, image_url, category, stock, status
- 购物车项目必须包含：product_id, quantity, unit_price, subtotal
- 购物车汇总必须包含：total_items, total_quantity, total_amount

### 2.3 业务规则
- 库存验证：添加数量不能超过库存
- 价格一致性：使用商品当前价格
- 用户隔离：用户只能操作自己的购物车
- 状态验证：只能添加active状态的商品

## 3. 代码质量标准

### 3.1 禁止的做法
- ❌ 为通过测试而简化业务逻辑
- ❌ 为通过测试而移除必要字段
- ❌ 临时补丁代码混入正式代码
- ❌ 跳过错误处理实现

### 3.2 必须的做法
- ✅ 完整的字段验证
- ✅ 完整的错误处理
- ✅ 完整的业务逻辑实现
- ✅ 完整的测试覆盖

## 4. 测试标准

### 4.1 测试覆盖要求
- 所有API端点
- 所有业务逻辑分支
- 所有错误情况
- 所有边界条件

### 4.2 测试数据要求
- 使用真实的完整数据结构
- 覆盖各种数据状态
- 包含异常数据测试

## 5. 文档要求

### 5.1 代码变更记录
- 新增功能清单
- 修改功能清单
- 删除代码清单
- 临时代码标识

### 5.2 测试记录
- 测试用例清单
- 测试结果记录
- 问题修复记录

## 6. 下一步行动

根据此规范，立即对购物车功能进行：
1. 全面代码审查
2. 补充缺失功能
3. 完善测试用例
4. 清理临时代码
5. 规范文档记录
