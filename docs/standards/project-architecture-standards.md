# 项目架构标准

> **版本**: v1.0  
> **更新**: 2025-09-23  
> **状态**: 执行中  
> **适用范围**: 整个 ecommerce_platform 项目的完整目录架构规范
> **决策依据**: 基于 FastAPI + Clean Architecture 的电商平台架构标准

## 重要变更记录

### v1.0 (当前版本)
- **首次发布**: 建立完整的项目架构标准
- **全局覆盖**: 涵盖根目录、业务代码、测试、脚本、文档等所有目录
- **标准分离**: 与 document-standards.md 职责分工，避免重叠
- **架构指导**: 支持模块化单体→微服务演进路径

## 项目根目录架构标准

### 整体目录结构

```
ecommerce_platform/
├── app/                    # 业务应用代码 (Clean Architecture)
│   ├── __init__.py
│   ├── main.py            # FastAPI 应用入口
│   ├── core/              # 核心业务逻辑层
│   ├── adapters/          # 外部适配器层 
│   ├── modules/           # 业务模块 (DDD领域)
│   └── shared/            # 共享组件和工具
├── tests/                 # 测试代码 (按层级分类)
│   ├── unit/              # 单元测试
│   ├── integration/       # 集成测试
│   ├── e2e/               # 端到端测试
│   ├── performance/       # 性能测试
│   ├── security/          # 安全测试
│   └── conftest.py        # 测试配置
├── scripts/               # 开发和运维脚本
│   ├── dev_*.ps1          # 开发环境脚本
│   ├── *_test.ps1         # 测试执行脚本
│   └── README.md          # 脚本使用说明
├── docs/                  # 项目文档 (参考 document-standards.md)
├── alembic/               # 数据库迁移脚本
│   ├── versions/          # 迁移版本文件
│   └── env.py             # 迁移环境配置
├── logs/                  # 日志文件存储
├── .github/               # GitHub 工作流和配置
├── .venv/                 # Python 虚拟环境 (可选)
├── .pytest_cache/         # pytest 缓存 (自动生成)
├── pyproject.toml         # 项目配置和依赖管理
├── requirements*.txt      # 依赖列表 (生产/开发)
├── alembic.ini           # 数据库迁移配置
├── docker-compose.yml    # 容器编排配置
├── .env / .env.example   # 环境变量配置
├── .gitignore            # Git 忽略文件配置
├── README.md             # 项目总体介绍
├── MASTER.md             # 项目检查点控制文件
└── start.ps1             # 项目启动脚本
```

## 核心目录详细规范

### 1. app/ - 业务应用代码层

**架构原则**: 遵循 Clean Architecture 和 DDD (领域驱动设计)

```
app/
├── __init__.py
├── main.py                # FastAPI 应用入口点
├── core/                  # 核心业务逻辑层
│   ├── __init__.py
│   ├── entities/          # 核心业务实体
│   ├── use_cases/         # 业务用例 (应用服务层)
│   ├── interfaces/        # 抽象接口定义
│   └── exceptions/        # 业务异常定义
├── adapters/              # 外部适配器层
│   ├── __init__.py
│   ├── api/               # API 路由和控制器
│   ├── database/          # 数据持久化适配器
│   ├── external/          # 外部服务适配器
│   └── messaging/         # 消息传递适配器
├── modules/               # 业务模块 (DDD 限界上下文)
│   ├── user_auth/         # 用户认证模块
│   ├── product_catalog/   # 产品目录模块
│   ├── order_management/  # 订单管理模块
│   └── [其他业务模块]/
└── shared/                # 共享组件和工具
    ├── __init__.py
    ├── utils/             # 通用工具函数
    ├── constants/         # 常量定义
    ├── config/            # 配置管理
    └── middleware/        # 中间件
```

**边界管理规则**:
- **模块独立性**: 每个 modules/ 下的子模块必须能够独立演进为微服务
- **层次依赖**: core/ 不依赖 adapters/，adapters/ 依赖 core/
- **共享组件**: shared/ 只包含技术性通用组件，不包含业务逻辑
- **接口抽象**: 所有外部依赖通过 core/interfaces/ 抽象

### 2. tests/ - 测试代码层

**测试架构原则**: 按测试类型和测试范围分层组织

```
tests/
├── conftest.py            # 全局测试配置和 fixtures
├── unit/                  # 单元测试 (隔离测试单个组件)
│   ├── core/              # 核心业务逻辑单元测试
│   ├── adapters/          # 适配器层单元测试  
│   └── modules/           # 业务模块单元测试
├── integration/           # 集成测试 (测试组件间协作)
│   ├── api/               # API 集成测试
│   ├── database/          # 数据库集成测试
│   └── modules/           # 模块集成测试
├── e2e/                   # 端到端测试 (完整业务流程)
│   ├── user_flows/        # 用户业务流程测试
│   └── api_scenarios/     # API 场景测试
├── performance/           # 性能测试
│   ├── load_tests/        # 负载测试
│   └── stress_tests/      # 压力测试
├── security/              # 安全测试
│   ├── auth_tests/        # 认证安全测试
│   └── injection_tests/   # 注入攻击测试
├── factories/             # 测试数据工厂
├── generated/             # 自动生成的测试文件
└── smoke/                 # 冒烟测试
```

**测试命名和组织规则**:
- **文件命名**: `test_*.py` 或 `*_test.py`
- **结构对应**: 测试目录结构应镜像 app/ 目录结构
- **测试隔离**: 不同类型测试严格分离，避免相互影响
- **数据管理**: 使用 factories/ 统一管理测试数据创建

### 3. scripts/ - 脚本和工具层

**脚本分类原则**: 按功能和使用场景分类组织

```
scripts/
├── README.md              # 脚本使用说明和索引
├── dev_*.ps1             # 开发环境相关脚本
│   ├── dev_env.ps1       # 开发环境设置
│   ├── dev_tools.ps1     # 开发工具管理
│   └── dev_checkpoint.ps1 # 开发检查点执行
├── *_test.ps1            # 测试执行脚本
│   ├── smoke_test.ps1    # 冒烟测试
│   ├── integration_test.ps1 # 集成测试  
│   └── run_module_tests.ps1 # 模块测试
├── check_*.ps1           # 代码质量检查脚本
│   ├── check_code_standards.ps1 # 代码规范检查
│   └── check_naming_compliance.ps1 # 命名规范检查
├── setup_*.ps1           # 环境设置脚本
│   └── setup_test_env.ps1 # 测试环境设置
├── *.py                  # Python 工具脚本
│   ├── model_analyzer.py  # 模型分析工具
│   └── validate_*.py     # 验证工具
└── __pycache__/          # Python 脚本缓存
```

**脚本管理规则**:
- **命名规范**: 动词+名词形式，功能清晰
- **权限管理**: 执行脚本需要明确的权限说明
- **文档要求**: 每个脚本必须有清晰的使用说明
- **版本控制**: 重要脚本变更需要在 README.md 中记录

## 配置文件管理标准

### 项目配置文件职责分工

| 配置文件 | 职责范围 | 配置内容 | 更新频率 |
|---------|---------|---------|---------|
| **pyproject.toml** | 项目元数据和Python配置 | 依赖、构建配置、工具配置 | 低频 |
| **requirements*.txt** | Python依赖管理 | 生产/开发依赖列表 | 中频 |
| **.env / .env.example** | 环境变量配置 | 数据库连接、API密钥等 | 中频 |
| **alembic.ini** | 数据库迁移配置 | 数据库连接、迁移设置 | 低频 |
| **docker-compose.yml** | 容器编排配置 | 服务定义、网络配置 | 低频 |
| **.gitignore** | Git版本控制配置 | 忽略文件规则 | 低频 |

### 环境配置管理原则

- **安全性**: 敏感信息通过 .env 管理，不提交到版本控制
- **示例性**: .env.example 提供完整的配置模板
- **层次性**: 开发/测试/生产环境配置分离
- **一致性**: 所有环境使用相同的配置键名

## 文件组织边界规则

### 严格禁止的跨边界行为

| 违规类型 | 具体表现 | 危害后果 | 检测方法 |
|---------|---------|---------|---------|
| **业务代码混入配置** | app/ 中包含硬编码配置 | 环境迁移困难 | 代码扫描检查 |
| **测试代码混入业务** | app/ 中包含测试相关代码 | 生产环境污染 | 目录结构检查 |
| **临时文件长期存在** | 根目录包含临时测试文件 | 项目结构混乱 | 定期清理检查 |
| **脚本功能重复** | scripts/ 中功能重复的脚本 | 维护成本高 | 功能分析检查 |

### 目录职责边界定义

- **app/**: 纯业务代码，不包含测试、脚本、配置
- **tests/**: 纯测试代码，不包含业务逻辑、生产配置  
- **scripts/**: 纯工具脚本，不包含业务逻辑、测试代码
- **docs/**: 纯文档内容，不包含可执行代码
- **logs/**: 纯日志文件，系统自动生成，不手动编辑

## 版本控制和部署管理

### Git 管理规范

```
.git/                      # Git 版本控制数据
.github/                   # GitHub 工作流和模板
│   ├── workflows/         # CI/CD 工作流定义
│   ├── ISSUE_TEMPLATE/    # Issue 模板
│   └── PULL_REQUEST_TEMPLATE.md # PR 模板
.gitignore                 # 版本控制忽略规则
```

**版本控制原则**:
- **敏感信息**: .env、密钥文件必须在 .gitignore 中
- **生成文件**: 缓存、日志、构建产物不提交版本控制
- **大文件**: 使用 Git LFS 管理大型二进制文件
- **分支策略**: main/dev 分支管理，feature 分支开发

### 部署配置管理

- **容器化**: 使用 docker-compose.yml 统一开发和部署环境
- **环境变量**: 通过 .env 文件管理不同环境配置
- **数据库**: 通过 alembic/ 管理数据库版本迁移
- **日志**: 统一输出到 logs/ 目录，便于监控和调试

## 质量控制和合规检查

### 架构合规性检查

1. **目录结构检查**: 确保目录结构符合标准定义
2. **边界违规检测**: 检查跨边界的代码或配置
3. **命名规范验证**: 验证文件和目录命名符合规范
4. **依赖关系审查**: 确保模块依赖关系符合架构原则

### 自动化检查机制

- **pre-commit hooks**: 提交前自动检查代码质量
- **CI/CD pipeline**: 持续集成中进行架构合规检查  
- **定期审查**: 定期人工审查架构演进情况
- **文档同步**: 架构变更时必须同步更新此标准文档

## 架构演进路径

### 微服务演进准备

当前架构支持从模块化单体向微服务架构演进：

1. **模块边界清晰**: app/modules/ 中每个模块可独立提取
2. **接口抽象完整**: core/interfaces/ 支持服务边界定义
3. **数据隔离**: 每个模块数据可独立分离
4. **测试完备**: 完整的测试体系支持重构验证

### 演进触发条件

- **性能瓶颈**: 单体应用性能无法满足需求
- **团队扩展**: 开发团队规模增长需要并行开发
- **业务复杂度**: 业务领域复杂度超过单体架构管理能力
- **部署要求**: 需要独立部署和扩展特定功能模块

### 标准维护和更新

- **版本管理**: 架构标准变更必须更新版本号
- **变更记录**: 重要架构决策通过 ADR 记录
- **影响评估**: 架构变更前必须评估对现有代码的影响
- **团队沟通**: 标准更新后必须及时通知全体开发人员

---

**注意**: 本标准与 `docs/standards/document-standards.md` 职责分工明确，本文档专注整个项目架构，文档架构标准请参考专门的文档标准文件。