# 文档管理规范

> **版本**: v2.1  
> **更新**: 2025-09-23  
> **状态**: 执行中  
> **决策**: 基于ADR-0001文档架构调整决策  
> **重要修订**: 删除development/目录，新增tools/、status/、templates/、analysis/、_archive/目录标准定义  

## 重要变更记录

### v2.1 (当前版本)
- **架构同步**: 删除已废弃的development/目录定义
- **新增辅助层**: 补充tools/、status/、templates/、analysis/、_archive/目录标准规范  
- **边界完善**: 为新增目录类型定义明确的功能边界和禁止内容
- **标准一致性**: 确保文档标准与实际目录结构100%匹配

### v2.0
- **架构调整**: 建立四层文档体系（requirements→architecture→design→standards）
- **边界管理**: 强化模块/组件边界管理，支持微服务演进
- **目录重构**: 新增design/、planning/层级，优化文档分层
- **决策依据**: 遵循ADR-0001决策，解决文档架构混乱问题

### v1.0 (已废弃)
- 原有目录结构，存在层次混乱、边界不清等问题

## 适用范围

**本标准专门规范 `docs/` 目录的文档架构和管理规范**

- **适用范围**: 仅限 `docs/` 目录下的所有文档和子目录
- **不包含**: 根目录、`app/`、`scripts/`、`tests/`、`alembic/` 等代码目录的架构规范
- **补充说明**: 整个项目的完整架构规范请参考 `project-architecture-standards.md`

## docs/ 目录结构标准

基于模块化单体→微服务演进架构，建立四层文档体系：

```
docs/
├── requirements/      # 需求层：纯业务需求
├── architecture/      # 架构层：系统整体设计原则
├── design/           # 设计层：具体详细设计
│   ├── system/       # 系统级设计（技术选型、算法、集成）
│   ├── modules/      # 业务模块详细设计（保持模块边界）
│   └── components/   # 技术组件详细设计（保持组件边界）
├── standards/        # 标准层：开发规范和执行标准
│   ├── openapi.yaml  # API契约定义
│   └── ...          # 其他标准文档
├── planning/         # 项目管理层
├── operations/       # 运维部署层
├── adr/             # 架构决策记录
├── tools/           # 工具使用指南
├── status/          # 项目状态管理
├── templates/       # 文档标准模板
├── analysis/        # 分析报告归档
└── _archive/        # 废弃文档备份
```

## 四层文档体系职责

### 层次职责分工

| 层级 | 职责定位 | 内容特征 | 微服务演进考虑 |
|------|----------|----------|---------------|
| **requirements/** | 纯业务需求 | 做什么，不涉及如何做 | 需求不变，实现可变 |
| **architecture/** | 指导原则 | 为什么这样做，架构思路 | 提供演进策略和原则 |
| **design/** | 具体设计 | 怎么做，详细实现设计 | **保持模块/组件边界独立** |
| **standards/** | 执行规范 | 按什么标准做 | 跨服务统一标准 |

### 设计层边界划分

#### design/system/ - 系统级设计
- **职责**：系统级技术实现方案，承接架构层原则
- **边界原则**：具体技术选型和实现，不涉及业务逻辑
- **包含内容**：technology-stack.md, algorithm-design.md, integration-design.md等
- **禁止内容**：业务逻辑实现，模块特定配置

#### design/modules/ - 业务模块设计
- **职责**：各业务模块的独立详细设计
- **边界原则**：保持模块边界清晰，支持未来微服务拆分
- **包含内容**：requirements.md, design.md, database-design.md, api-spec.md
- **禁止内容**：跨模块的整合设计，避免模块耦合

#### design/components/ - 技术组件设计  
- **职责**：技术基础组件的独立详细设计
- **边界原则**：保持组件边界清晰，支持未来服务化演进
- **包含内容**：application-core, database-core, redis-cache, base-models
- **禁止内容**：业务逻辑混入，避免技术与业务耦合

### 架构层与设计层职责边界

| 内容类型 | 架构层职责 (architecture/) | 设计层职责 (design/system/) |
|---------|---------------------------|----------------------------|
| **技术选型** | 技术选型原则、演进策略 | 具体技术栈、版本选择、配置方案 |
| **算法设计** | 算法策略和架构原则 | 具体算法实现、性能优化细节 |
| **集成设计** | 集成架构原则、模式选择 | 具体集成方案、接口设计、协议定义 |
| **安全架构** | 安全策略、架构原则 | 具体安全实现、加密算法、认证方案 |
| **性能设计** | 性能架构原则、策略 | 具体性能优化、缓存设计、负载方案 |
| **部署架构** | 部署策略、演进路径 | 具体部署配置、容器化、CI/CD方案 |

## 四层文档体系详细说明

### 1. requirements/ - 需求层
**职责**: 纯业务需求定义，不涉及技术实现
**文档特征**: 做什么（What），用户故事，业务规则
**约束原则**: 技术无关，面向业务价值
**示例**: 用户注册需求、商品管理需求、订单流程需求

### 2. architecture/ - 架构层  
**职责**: 系统整体架构思路和设计原则
**文档特征**: 为什么这样做（Why），架构思维，演进策略
**约束原则**: 指导性原则，不涉及具体实现细节
**示例**: 模块化架构原则、微服务演进策略、数据一致性策略

### 3. design/ - 设计层
**职责**: 具体的详细设计文档
**文档特征**: 怎么做（How），技术实现，详细方案

#### 3.1 design/system/ - 系统级设计
**职责**: 承接架构层原则，提供系统级技术实现方案
**约束原则**: 具体技术选型、算法实现、系统集成的详细设计
**文档结构**: 
- technology-stack.md - 技术栈选型和版本规划
- algorithm-design.md - 核心算法设计和实现
- integration-design.md - 系统集成和模块协作设计  
- performance-design.md - 性能设计和优化方案
- security-design.md - 安全实现设计和加密方案
- deployment-design.md - 部署架构和运维设计
**边界要求**: 承接架构原则，不包含具体业务逻辑

#### 3.2 design/modules/ - 业务模块设计
**约束原则**: 保持模块边界独立，支持微服务演进
**文档结构**: 每个模块包含 requirements.md, design.md, database-design.md, api-spec.md
**边界要求**: 禁止跨模块设计，避免模块耦合

#### 3.3 design/components/ - 技术组件设计  
**约束原则**: 保持组件边界清晰，技术与业务分离
**文档结构**: application-core, database-core, redis-cache, base-models
**边界要求**: 禁止业务逻辑混入技术组件

### 4. standards/ - 标准层
**职责**: 开发规范和执行标准  
**文档特征**: 按什么标准做（Standard），约束性规范
**约束原则**: 具有强制约束力，跨服务统一标准
**示例**: API设计规范、数据库设计规范、代码风格指南

### 5. 辅助层级
- **planning/**: 项目管理和进度跟踪
- **operations/**: 运维部署和监控指南
- **adr/**: 架构决策记录，记录重要技术决策
- **tools/**: 开发工具和脚本使用指南
- **status/**: 项目状态跟踪和问题记录
- **templates/**: 文档创建模板和标准格式
- **analysis/**: 代码分析报告和审计结果
- **_archive/**: 历史文档和过期内容存档

## 文档功能定义

### README文档职责

#### 根目录README.md
**功能定位**：项目入口导航
**必须包含**：项目介绍、核心特性、快速开始、文档导航
**禁止包含**：详细配置、完整API说明、实现细节、重复内容

#### 目录README.md  
**功能定位**：目录内容索引和结构说明
**必须包含**：
- 目录用途说明
- 完整目录结构图（包含所有子目录和重要文件）
- 每个子目录的名称和作用说明
- 每个重要文件的名称和作用说明
- 相关文档链接

**禁止包含**：文件详细内容、跨目录说明、重复介绍

#### 模块README.md
**功能定位**：模块功能概览
**必须包含**：模块用途、关键功能、使用入口、相关文档
**禁止包含**：详细实现、完整配置、API详细规范

### 目录结构同步要求

#### 强制同步原则
- README中的目录结构必须与实际目录结构完全一致
- 新增/删除目录时必须同步更新README
- 重命名目录时必须同步更新README中的说明

#### 结构说明格式
```
目录名/
├── 子目录1/              # 子目录作用说明
├── 子目录2/              # 子目录作用说明
├── 重要文件1.ext         # 文件作用说明
└── 重要文件2.ext         # 文件作用说明
```

### 模块/组件边界管理规则

#### 微服务演进边界原则
- **模块边界独立性**：每个业务模块必须能够独立演进为微服务
- **组件边界清晰性**：技术组件必须保持通用性，不依赖特定业务
- **文档边界一致性**：文档结构必须反映代码架构边界

#### 边界违规禁止规则
| 违规类型 | 具体表现 | 危害后果 | 检查方法 |
|---------|---------|---------|---------|
| **跨模块设计** | 在单一文档中描述多个业务模块 | 阻碍微服务拆分 | 检查文档是否涉及多个模块 |
| **业务技术混合** | 技术组件包含业务逻辑 | 降低组件复用性 | 检查技术组件是否业务无关 |
| **循环依赖** | 模块间相互依赖 | 无法独立部署 | 检查依赖关系图 |
| **共享状态** | 模块间共享可变状态 | 数据一致性问题 | 检查数据库设计 |

### 技术文档分类

| 文档类型 | 存放位置 | 功能定位 | 禁止内容 | 边界要求 |
|---------|---------|---------|---------|---------|
| **需求文档** | requirements/ | 业务需求、功能规格 | 技术实现、代码细节 | 业务价值导向 |
| **架构设计** | architecture/ | 系统设计原则、架构思维 | 具体技术版本、实现代码 | **指导性原则** |
| **系统设计** | design/system/ | 技术选型、算法实现、集成方案 | 业务逻辑、模块特定细节 | **系统级技术边界** |
| **模块设计** | design/modules/ | 业务模块详细设计 | 跨模块集成、其他模块细节 | **严格模块边界** |
| **组件设计** | design/components/ | 技术组件详细设计 | 业务逻辑、模块特定实现 | **严格组件边界** |
| **开发标准** | standards/ | 开发规范、API契约定义 | 具体实现、业务逻辑 | 统一标准 |  
| **运维文档** | operations/ | 部署配置、监控运维 | 开发细节、业务逻辑 | 运维专用 |
| **工具文档** | tools/ | 脚本使用、工具配置、测试管理 | 业务逻辑、架构设计 | 工具操作指导 |
| **状态文档** | status/ | 进度跟踪、问题记录、工作历史 | 技术实现、设计细节 | 项目管理专用 |
| **模板文档** | templates/ | 文档创建模板、标准格式 | 具体内容、业务逻辑 | 格式标准化 |
| **分析文档** | analysis/ | 代码分析、测试报告、审计结果 | 未来规划、架构设计 | 现状分析专用 |
| **存档文档** | _archive/ | 历史文档、过期内容 | 当前有效信息 | 历史保存专用 |### 测试脚本管理规范

#### 测试脚本分类和存放位置
| 脚本类型 | 存放位置 | 命名规范 | 用途 |
|---------|---------|---------|------|
| **单元测试** | tests/ | test_*.py | 模块功能测试 |
| **集成测试** | tests/integration/ | test_*_integration.py | 模块间协作测试 |
| **系统测试** | scripts/ | *_test.ps1 | 端到端系统测试 |
| **临时测试脚本** | 根目录 | test_*.py | 开发调试用（临时） |

#### 根目录测试脚本处理规则
- **允许情况**：开发调试期间的临时测试脚本
- **命名要求**：必须以`test_`开头，包含功能描述
- **生命周期**：功能开发完成后必须移至`tests/`目录或删除
- **文档要求**：临时脚本需在README.md中说明用途和计划

#### 强制清理触发条件
- **功能完成提交** → 清理根目录临时测试脚本
- **版本发布前** → 确保根目录无临时测试文件
- **代码审查时** → 检查测试脚本分类是否正确

### 辅助层级目录详细规范

#### 6.1 tools/ - 工具文档层
**功能定位**: 开发工具使用指南和脚本配置文档
**必须包含**: 
- scripts-usage-manual.md - 脚本使用手册
- testing-tools.md - 测试工具配置和使用
- test-management.md - 测试管理流程
- troubleshooting.md - 工具问题排查

**禁止包含**: 业务逻辑文档、架构设计内容、具体代码实现
**边界要求**: 专注工具操作指导，不涉及业务架构

#### 6.2 status/ - 状态跟踪层  
**功能定位**: 项目进度跟踪和状态管理
**必须包含**:
- current-work-status.md - 当前工作状态
- work-history-archive.md - 工作历史存档
- module-status.md - 模块开发状态
- issues-tracking.md - 问题跟踪记录
- checkpoint-log.md - 检查点执行日志

**禁止包含**: 技术实现细节、设计方案、业务需求分析
**边界要求**: 专注状态记录，实时更新，支持项目管理决策

#### 6.3 templates/ - 模板标准层
**功能定位**: 文档创建模板和格式标准
**必须包含**: 
- module-template.md - 模块文档模板
- module-requirements-template.md - 需求文档模板  
- module-design-template.md - 设计文档模板
- module-implementation-template.md - 实现文档模板
- module-readme-template.md - README文档模板

**禁止包含**: 具体业务内容、技术实现、项目特定信息
**边界要求**: 纯格式标准，保持通用性和可重用性

#### 6.4 analysis/ - 分析报告层
**功能定位**: 代码分析、测试报告和审计结果
**必须包含**: 
- 代码质量分析报告
- 测试覆盖率报告  
- 性能分析报告
- 安全审计报告
- 技术债务分析

**禁止包含**: 未来规划内容、架构设计建议、业务需求分析
**边界要求**: 专注现状分析，基于事实数据，支持技术决策

#### 6.5 _archive/ - 历史存档层
**功能定位**: 历史文档和过期内容的结构化存档
**存档触发条件**:
- 文档被新版本替代且旧版本仍有参考价值
- 项目阶段性完成后的里程碑文档保存
- 重大架构变更前的历史状态保存

**存档结构要求**:
```
_archive/
├── YYYY-MM/           # 按年月归档
├── milestone-v1.0/    # 按里程碑归档  
└── deprecated/        # 废弃文档归档
```

**禁止包含**: 当前有效信息、未来计划、临时工作文件
**边界要求**: 严格历史保存，禁止修改，仅供查询参考

## README同步触发机制

### 强制同步触发条件
- **创建新模块** → 必须同时创建/更新模块README.md
- **修改API接口** → 必须更新相关模块README.md
- **变更项目结构** → 必须更新根目录README.md
- **添加新功能** → 必须更新对应目录README.md
- **修改启动方式** → 必须更新根目录README.md

### 同步检查执行格式
🔍 检查点触发：[文件操作类型]
📋 必须验证：检查对应README.md是否需要更新
✅ 验证确认：确认README内容与实际代码一致
🚫 执行操作：更新README.md内容

### 自动触发规则
IF create_file app/modules/* THEN 更新 docs/design/modules/README.md
IF 修改 main.py THEN 检查根目录README.md
IF create_file docs/* THEN 更新对应目录README.md
IF 修改启动脚本 THEN 更新根目录README.md快速开始部分

## 文档创建与管理

## 文档创建与管理

### 创建前强制检查
1. `grep_search "关键词" docs/` - 搜索已有文档
2. `list_dir docs/目标目录/` - 检查目录结构  
3. 确认无功能重复 - 更新现有文档而非新建

### 命名规范
- 使用英文小写字母，单词间连字符分隔
- README.md - 目录导航（每目录必有）
- overview.md - 概述文档
- api-spec.md - API接口规范（详细的接口规范要求、参数传递规范）
- api-implementation.md - API接口实施细节记录（具体实施过程、代码实现）
- 文件名清晰表达内容用途

#### API文档职责分工
- **api-spec.md**：遵循 standards/openapi.yaml 契约，详细定义接口规范、参数传递、错误处理等技术要求
- **api-implementation.md**：记录接口具体实施细节、开发过程、实现方案等开发记录

#### 全局API契约管理
- **standards/openapi.yaml**：项目API宪法，所有接口开发必须遵守的技术契约
- **位置要求**：API契约文档必须存放在 standards/ 目录，与其他开发标准统一管理
- **引用关系**：各模块 api-spec.md 必须引用并遵循全局契约定义

#### ADR文档管理规范
- **目录结构**：docs/adr/ 专门存放所有ADR文档
- **文件命名**：ADR-0001-选择fastapi框架.md（四位编号+简洁标题）
- **索引管理**：docs/adr/README.md 维护ADR完整索引和状态
- **标准格式**：Status/Date/Context/Decision/Consequences/References/Related必备要素
- **状态管理**：Proposed→Accepted→Deprecated/Superseded 完整生命周期跟踪
- **更新规则**：任何架构决策前必须先审查既有ADR，避免冲突决策
- **引用要求**：必须包含参考资料和相关决策的双向链接
- **维护责任**：每个ADR必须有明确的Context背景和Consequences影响分析

### 禁止行为
- 不检查就创建文档
- 创建功能重复文档  
- 在README中添加实现细节
- 跨目录重复内容
- 删除文档不迁移有价值内容

## 质量控制与执行检查

### 文档创建前强制检查
1. **目标确认**: 确认文档功能定位和存放层级
2. **重复检查**: 搜索现有文档，避免功能重复
3. **边界验证**: 确认不违反模块/组件边界规则
4. **标准遵循**: 按照本标准规范执行文档结构

### 内容质量检查要点
- **功能定位**: 文档功能是否明确、无重复
- **禁止内容**: 是否违反层级禁止内容规则
- **边界管理**: 是否违反模块/组件边界原则
- **标准一致**: 是否遵循统一的文档格式标准
- **链接有效**: 文档间链接引用是否正确有效

### 边界违规检测机制
| 检测项目 | 检测方法 | 违规阈值 | 处理措施 |
|---------|---------|---------|---------|
| **跨模块引用** | 扫描模块文档中其他模块关键词 | >3次提及其他模块 | 拆分文档或调整边界 |
| **业务技术混合** | 检查技术组件中业务术语 | 包含业务流程描述 | 移除业务逻辑到模块层 |
| **内容重复** | 比较文档相似度 | >30%内容相似 | 合并或重新分工 |
| **层级越界** | 检查文档内容是否符合层级定位 | 包含禁止内容 | 调整内容或移动位置 |

### 维护执行原则
- **边界优先**: 保持模块/组件边界清晰是最高优先级
- **演进支持**: 任何文档变更都必须考虑微服务演进影响
- **标准权威**: 本文档为唯一权威标准，任何冲突以此为准
- **同步更新**: 目录结构变更时必须同步更新相关README
- **定期审查**: 按季度审查文档架构合理性和边界完整性

### 执行监督机制
- **MASTER检查点**: 通过MASTER.md强制执行文档标准遵循
- **ADR决策**: 重大文档架构变更必须通过ADR记录决策过程
- **自动化检测**: 通过脚本自动检测边界违规和内容重复
- **人工审核**: 关键文档变更需要人工审核确认边界合规性