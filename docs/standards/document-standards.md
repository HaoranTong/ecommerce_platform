# 文档管理规范

> **版本**: v2.0  
> **更新**: 2025-01-xx  
> **状态**: 执行中  
> **决策**: 基于ADR-0001文档架构调整决策  

## 重要变更记录

### v2.0 (当前版本)
- **架构调整**: 建立四层文档体系（requirements→architecture→design→standards）
- **边界管理**: 强化模块/组件边界管理，支持微服务演进
- **目录重构**: 新增design/、planning/层级，优化文档分层
- **决策依据**: 遵循ADR-0001决策，解决文档架构混乱问题

### v1.0 (已废弃)
- 原有目录结构，存在层次混乱、边界不清等问题

## 目录结构标准

基于模块化单体→微服务演进架构，建立四层文档体系：

```
docs/
├── requirements/      # 需求层：纯业务需求
├── architecture/      # 架构层：系统整体设计原则
├── design/           # 设计层：具体详细设计
│   ├── modules/      # 业务模块详细设计（保持模块边界）
│   └── components/   # 技术组件详细设计（保持组件边界）
├── planning/         # 项目管理层
├── standards/        # 标准层：开发规范和执行标准
│   ├── openapi.yaml  # API契约定义
│   └── ...          # 其他标准文档
├── development/      # 开发指南层
├── operations/       # 运维部署层
├── adr/             # 架构决策记录
├── status/          # 项目状态管理
├── analysis/        # 分析报告归档
├── templates/       # 文档标准模板
└── _archive/        # 废弃文档备份
```

## 四层文档体系职责

### 层次职责分工

| 层级 | 职责定位 | 内容特征 | 微服务演进考虑 |
|------|----------|----------|---------------|
| **requirements/** | 纯业务需求 | 做什么，不涉及如何做 | 需求不变，实现可变 |
| **architecture/** | 指导原则 | 为什么这样做，架构思路 | 提供演进策略和原则 |
| **design/** | 具体设计 | 怎么做，详细实现设计 | **保持模块/组件边界独立** |
| **standards/** | 执行规范 | 按什么标准做 | 跨服务统一标准 |

### 设计层边界划分

#### design/modules/ - 业务模块设计
- **职责**：各业务模块的独立详细设计
- **边界原则**：保持模块边界清晰，支持未来微服务拆分
- **包含内容**：requirements.md, design.md, database-design.md, api-spec.md
- **禁止内容**：跨模块的整合设计，避免模块耦合

#### design/components/ - 技术组件设计  
- **职责**：技术基础组件的独立详细设计
- **边界原则**：保持组件边界清晰，支持未来服务化演进
- **包含内容**：application-core, database-core, redis-cache, base-models
- **禁止内容**：业务逻辑混入，避免技术与业务耦合

## 四层文档体系详细说明

### 1. requirements/ - 需求层
**职责**: 纯业务需求定义，不涉及技术实现
**文档特征**: 做什么（What），用户故事，业务规则
**约束原则**: 技术无关，面向业务价值
**示例**: 用户注册需求、商品管理需求、订单流程需求

### 2. architecture/ - 架构层  
**职责**: 系统整体架构思路和设计原则
**文档特征**: 为什么这样做（Why），架构思维，演进策略
**约束原则**: 指导性原则，不涉及具体实现细节
**示例**: 模块化架构原则、微服务演进策略、数据一致性策略

### 3. design/ - 设计层
**职责**: 具体的详细设计文档
**文档特征**: 怎么做（How），技术实现，详细方案

#### 3.1 design/modules/ - 业务模块设计
**约束原则**: 保持模块边界独立，支持微服务演进
**文档结构**: 每个模块包含 requirements.md, design.md, database-design.md, api-spec.md
**边界要求**: 禁止跨模块设计，避免模块耦合

#### 3.2 design/components/ - 技术组件设计  
**约束原则**: 保持组件边界清晰，技术与业务分离
**文档结构**: application-core, database-core, redis-cache, base-models
**边界要求**: 禁止业务逻辑混入技术组件

### 4. standards/ - 标准层
**职责**: 开发规范和执行标准  
**文档特征**: 按什么标准做（Standard），约束性规范
**约束原则**: 具有强制约束力，跨服务统一标准
**示例**: API设计规范、数据库设计规范、代码风格指南

### 5. 辅助层级
- **planning/**: 项目管理和进度跟踪
- **development/**: 开发环境和开发流程指南  
- **operations/**: 运维部署和监控指南
- **adr/**: 架构决策记录，记录重要技术决策

## 文档功能定义

### README文档职责

#### 根目录README.md
**功能定位**：项目入口导航
**必须包含**：项目介绍、核心特性、快速开始、文档导航
**禁止包含**：详细配置、完整API说明、实现细节、重复内容

#### 目录README.md  
**功能定位**：目录内容索引和结构说明
**必须包含**：
- 目录用途说明
- 完整目录结构图（包含所有子目录和重要文件）
- 每个子目录的名称和作用说明
- 每个重要文件的名称和作用说明
- 相关文档链接

**禁止包含**：文件详细内容、跨目录说明、重复介绍

#### 模块README.md
**功能定位**：模块功能概览
**必须包含**：模块用途、关键功能、使用入口、相关文档
**禁止包含**：详细实现、完整配置、API详细规范

### 目录结构同步要求

#### 强制同步原则
- README中的目录结构必须与实际目录结构完全一致
- 新增/删除目录时必须同步更新README
- 重命名目录时必须同步更新README中的说明

#### 结构说明格式
```
目录名/
├── 子目录1/              # 子目录作用说明
├── 子目录2/              # 子目录作用说明
├── 重要文件1.ext         # 文件作用说明
└── 重要文件2.ext         # 文件作用说明
```

### 模块/组件边界管理规则

#### 微服务演进边界原则
- **模块边界独立性**：每个业务模块必须能够独立演进为微服务
- **组件边界清晰性**：技术组件必须保持通用性，不依赖特定业务
- **文档边界一致性**：文档结构必须反映代码架构边界

#### 边界违规禁止规则
| 违规类型 | 具体表现 | 危害后果 | 检查方法 |
|---------|---------|---------|---------|
| **跨模块设计** | 在单一文档中描述多个业务模块 | 阻碍微服务拆分 | 检查文档是否涉及多个模块 |
| **业务技术混合** | 技术组件包含业务逻辑 | 降低组件复用性 | 检查技术组件是否业务无关 |
| **循环依赖** | 模块间相互依赖 | 无法独立部署 | 检查依赖关系图 |
| **共享状态** | 模块间共享可变状态 | 数据一致性问题 | 检查数据库设计 |

### 技术文档分类

| 文档类型 | 存放位置 | 功能定位 | 禁止内容 | 边界要求 |
|---------|---------|---------|---------|---------|
| **需求文档** | requirements/ | 业务需求、功能规格 | 技术实现、代码细节 | 业务价值导向 |
| **架构设计** | architecture/ | 系统设计决策、技术选型 | 实现代码、配置详情 | 指导性原则 |
| **模块设计** | design/modules/ | 业务模块详细设计 | 跨模块集成、其他模块细节 | **严格模块边界** |
| **组件设计** | design/components/ | 技术组件详细设计 | 业务逻辑、模块特定实现 | **严格组件边界** |
| **开发标准** | standards/ | 开发规范、API契约定义 | 具体实现、业务逻辑 | 统一标准 |  
| **开发指南** | development/ | 环境配置、工具使用 | 业务需求、架构设计 | 操作指导 |
| **运维文档** | operations/ | 部署配置、监控运维 | 开发细节、业务逻辑 | 运维专用 |

### 测试脚本管理规范

#### 测试脚本分类和存放位置
| 脚本类型 | 存放位置 | 命名规范 | 用途 |
|---------|---------|---------|------|
| **单元测试** | tests/ | test_*.py | 模块功能测试 |
| **集成测试** | tests/integration/ | test_*_integration.py | 模块间协作测试 |
| **系统测试** | scripts/ | *_test.ps1 | 端到端系统测试 |
| **临时测试脚本** | 根目录 | test_*.py | 开发调试用（临时） |

#### 根目录测试脚本处理规则
- **允许情况**：开发调试期间的临时测试脚本
- **命名要求**：必须以`test_`开头，包含功能描述
- **生命周期**：功能开发完成后必须移至`tests/`目录或删除
- **文档要求**：临时脚本需在README.md中说明用途和计划

#### 强制清理触发条件
- **功能完成提交** → 清理根目录临时测试脚本
- **版本发布前** → 确保根目录无临时测试文件
- **代码审查时** → 检查测试脚本分类是否正确

## README同步触发机制

### 强制同步触发条件
- **创建新模块** → 必须同时创建/更新模块README.md
- **修改API接口** → 必须更新相关模块README.md
- **变更项目结构** → 必须更新根目录README.md
- **添加新功能** → 必须更新对应目录README.md
- **修改启动方式** → 必须更新根目录README.md

### 同步检查执行格式
🔍 检查点触发：[文件操作类型]
📋 必须验证：检查对应README.md是否需要更新
✅ 验证确认：确认README内容与实际代码一致
🚫 执行操作：更新README.md内容

### 自动触发规则
IF create_file app/modules/* THEN 更新 docs/modules/README.md
IF 修改 main.py THEN 检查根目录README.md
IF create_file docs/* THEN 更新对应目录README.md
IF 修改启动脚本 THEN 更新根目录README.md快速开始部分

## 文档创建与管理

## 文档创建与管理

### 创建前强制检查
1. `grep_search "关键词" docs/` - 搜索已有文档
2. `list_dir docs/目标目录/` - 检查目录结构  
3. 确认无功能重复 - 更新现有文档而非新建

### 命名规范
- 使用英文小写字母，单词间连字符分隔
- README.md - 目录导航（每目录必有）
- overview.md - 概述文档
- api-spec.md - API接口规范（详细的接口规范要求、参数传递规范）
- api-implementation.md - API接口实施细节记录（具体实施过程、代码实现）
- 文件名清晰表达内容用途

#### API文档职责分工
- **api-spec.md**：遵循 standards/openapi.yaml 契约，详细定义接口规范、参数传递、错误处理等技术要求
- **api-implementation.md**：记录接口具体实施细节、开发过程、实现方案等开发记录

#### 全局API契约管理
- **standards/openapi.yaml**：项目API宪法，所有接口开发必须遵守的技术契约
- **位置要求**：API契约文档必须存放在 standards/ 目录，与其他开发标准统一管理
- **引用关系**：各模块 api-spec.md 必须引用并遵循全局契约定义

#### ADR文档管理规范
- **目录结构**：docs/adr/ 专门存放所有ADR文档
- **文件命名**：ADR-0001-选择fastapi框架.md（四位编号+简洁标题）
- **索引管理**：docs/adr/README.md 维护ADR完整索引和状态
- **标准格式**：Status/Date/Context/Decision/Consequences/References/Related必备要素
- **状态管理**：Proposed→Accepted→Deprecated/Superseded 完整生命周期跟踪
- **更新规则**：任何架构决策前必须先审查既有ADR，避免冲突决策
- **引用要求**：必须包含参考资料和相关决策的双向链接
- **维护责任**：每个ADR必须有明确的Context背景和Consequences影响分析

### 禁止行为
- 不检查就创建文档
- 创建功能重复文档  
- 在README中添加实现细节
- 跨目录重复内容
- 删除文档不迁移有价值内容

## 质量控制与执行检查

### 文档创建前强制检查
1. **目标确认**: 确认文档功能定位和存放层级
2. **重复检查**: 搜索现有文档，避免功能重复
3. **边界验证**: 确认不违反模块/组件边界规则
4. **标准遵循**: 按照本标准规范执行文档结构

### 内容质量检查要点
- **功能定位**: 文档功能是否明确、无重复
- **禁止内容**: 是否违反层级禁止内容规则
- **边界管理**: 是否违反模块/组件边界原则
- **标准一致**: 是否遵循统一的文档格式标准
- **链接有效**: 文档间链接引用是否正确有效

### 边界违规检测机制
| 检测项目 | 检测方法 | 违规阈值 | 处理措施 |
|---------|---------|---------|---------|
| **跨模块引用** | 扫描模块文档中其他模块关键词 | >3次提及其他模块 | 拆分文档或调整边界 |
| **业务技术混合** | 检查技术组件中业务术语 | 包含业务流程描述 | 移除业务逻辑到模块层 |
| **内容重复** | 比较文档相似度 | >30%内容相似 | 合并或重新分工 |
| **层级越界** | 检查文档内容是否符合层级定位 | 包含禁止内容 | 调整内容或移动位置 |

### 维护执行原则
- **边界优先**: 保持模块/组件边界清晰是最高优先级
- **演进支持**: 任何文档变更都必须考虑微服务演进影响
- **标准权威**: 本文档为唯一权威标准，任何冲突以此为准
- **同步更新**: 目录结构变更时必须同步更新相关README
- **定期审查**: 按季度审查文档架构合理性和边界完整性

### 执行监督机制
- **MASTER检查点**: 通过MASTER.md强制执行文档标准遵循
- **ADR决策**: 重大文档架构变更必须通过ADR记录决策过程
- **自动化检测**: 通过脚本自动检测边界违规和内容重复
- **人工审核**: 关键文档变更需要人工审核确认边界合规性