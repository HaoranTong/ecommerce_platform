<!--
æ–‡æ¡£è¯´æ˜ï¼š
- å†…å®¹ï¼šè´¨é‡æ§åˆ¶æ¨¡å—åŠŸèƒ½æ¦‚è§ˆï¼ŒåŒ…æ‹¬è¯ä¹¦ç®¡ç†ã€è´¨é‡è®¤è¯ã€åˆè§„æ£€æŸ¥ç­‰æ ¸å¿ƒåŠŸèƒ½
- ä½¿ç”¨æ–¹æ³•ï¼šè´¨é‡æ§åˆ¶æ¨¡å—è®¾è®¡å’Œå¼€å‘çš„æŒ‡å¯¼æ–‡æ¡£ï¼Œå¼€å‘å‰å¿…è¯»
- æ›´æ–°æ–¹æ³•ï¼šæ¨¡å—åŠŸèƒ½å˜æ›´æ—¶æ›´æ–°ï¼Œéœ€è¦æ¶æ„å¸ˆç¡®è®¤
- å¼•ç”¨å…³ç³»ï¼šè¢«å…¶ä»–æ¨¡å—æ–‡æ¡£å’ŒAPIè§„èŒƒæ–‡æ¡£å¼•ç”¨
- æ›´æ–°é¢‘ç‡ï¼šåŠŸèƒ½è¿­ä»£æ—¶
-->

# è´¨é‡æ§åˆ¶æ¨¡å— (Quality Control Module)

ğŸ“ **çŠ¶æ€**: âœ… å·²å‘å¸ƒ  
ğŸ“… **åˆ›å»ºæ—¥æœŸ**: 2025-09-13  
ğŸ‘¤ **è´Ÿè´£äºº**: ç³»ç»Ÿæ¶æ„å¸ˆ  
ğŸ”„ **æœ€åæ›´æ–°**: 2025-09-13  
ğŸ“‹ **ç‰ˆæœ¬**: v1.0.0  

## æ¨¡å—æ¦‚è¿°

### ä¸»è¦èŒè´£
è´¨é‡æ§åˆ¶æ¨¡å—è´Ÿè´£å†œäº§å“ç”µå•†å¹³å°çš„è´¨é‡è®¤è¯ç®¡ç†ï¼Œç¡®ä¿å•†å“è´¨é‡å¯è¿½æº¯å’Œæ¶ˆè´¹è€…ä¿¡ä»»ï¼š
- **è¯ä¹¦å­˜å‚¨ç®¡ç†** - ç»Ÿä¸€ç®¡ç†å„ç±»è´¨é‡è®¤è¯è¯ä¹¦
- **è´¨é‡è®¤è¯éªŒè¯** - éªŒè¯ç¬¬ä¸‰æ–¹æœºæ„è®¤è¯è¯ä¹¦çš„çœŸå®æ€§
- **åˆè§„æ€§æ£€æŸ¥** - ç¡®ä¿å†œäº§å“ç¬¦åˆé£Ÿå“å®‰å…¨æ³•è§„è¦æ±‚
- **æº¯æºå…³è”æœåŠ¡** - ä¸ºæ‰¹æ¬¡æº¯æºæä¾›è´¨é‡è¯æ˜æ”¯æ’‘
- **æ¶ˆè´¹è€…å±•ç¤º** - åœ¨å•†å“é¡µé¢å±•ç¤ºæƒå¨è®¤è¯ä¿¡æ¯

### ä¸šåŠ¡ä»·å€¼
- **æ ¸å¿ƒä»·å€¼**: é€šè¿‡æƒå¨è®¤è¯å»ºç«‹æ¶ˆè´¹è€…å¯¹å†œäº§å“è´¨é‡çš„ä¿¡ä»»
- **ç”¨æˆ·æ”¶ç›Š**: æ¶ˆè´¹è€…å¯ä»¥æŸ¥çœ‹æƒå¨è´¨æ£€æŠ¥å‘Šï¼Œæ”¾å¿ƒè´­ä¹°å†œäº§å“
- **ç³»ç»Ÿæ”¶ç›Š**: ä¸ºæ•´ä¸ªç”µå•†å¹³å°å»ºç«‹è´¨é‡ä¿è¯ä½“ç³»ï¼Œæå‡å“ç‰Œä»·å€¼

### æ¨¡å—è¾¹ç•Œ
- **åŒ…å«åŠŸèƒ½**: è¯ä¹¦CRUDç®¡ç†ã€è¯ä¹¦éªŒè¯æŸ¥è¯¢ã€è´¨é‡ä¿¡æ¯å±•ç¤º
- **æ’é™¤åŠŸèƒ½**: ä¸åŒ…å«è´¨é‡æ£€æµ‹è¿‡ç¨‹ã€ä¸è´Ÿè´£æ£€æµ‹æœºæ„å¯¹æ¥
- **ä¾èµ–æ¨¡å—**: å…±äº«æ•°æ®æ¨¡å‹(Certificate)ã€æ‰¹æ¬¡æº¯æºæ¨¡å—
- **è¢«ä¾èµ–**: å•†å“ç®¡ç†æ¨¡å—ã€è®¢å•ç®¡ç†æ¨¡å—ã€ä¾›åº”å•†ç®¡ç†æ¨¡å—

## æŠ€æœ¯æ¶æ„

### æ¶æ„å›¾
```
è´¨é‡æ§åˆ¶æ¨¡å—æ¶æ„
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Quality Control                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  API Layer                                          â”‚
â”‚  â”œâ”€â”€ POST /certificates        åˆ›å»ºè¯ä¹¦             â”‚
â”‚  â”œâ”€â”€ GET  /certificates        è·å–è¯ä¹¦åˆ—è¡¨         â”‚
â”‚  â”œâ”€â”€ GET  /certificates/{id}   è·å–è¯ä¹¦è¯¦æƒ…         â”‚
â”‚  â””â”€â”€ DELETE /certificates/{id} åˆ é™¤è¯ä¹¦             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Service Layer                                      â”‚
â”‚  â”œâ”€â”€ CertificateService        è¯ä¹¦ä¸šåŠ¡é€»è¾‘         â”‚
â”‚  â”œâ”€â”€ ValidationService         è¯ä¹¦éªŒè¯æœåŠ¡         â”‚
â”‚  â””â”€â”€ ComplianceService         åˆè§„æ£€æŸ¥æœåŠ¡         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Data Layer                                         â”‚
â”‚  â””â”€â”€ Certificate Model         è¯ä¹¦æ•°æ®æ¨¡å‹         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                           â”‚
          â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Batch Module   â”‚         â”‚ Product Module  â”‚
â”‚   æ‰¹æ¬¡æº¯æºæ¨¡å—   â”‚         â”‚   å•†å“ç®¡ç†æ¨¡å—   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç»„ä»¶
```
quality_control/
â”œâ”€â”€ router.py           # APIè·¯ç”±å®šä¹‰
â”œâ”€â”€ service.py          # ä¸šåŠ¡é€»è¾‘å¤„ç†
â”œâ”€â”€ models.py           # æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆå½“å‰ä¸ºç©ºï¼Œä½¿ç”¨å…±äº«æ¨¡å‹ï¼‰
â”œâ”€â”€ schemas.py          # è¯·æ±‚/å“åº”æ¨¡å‹ï¼ˆå¾…å®ç°ï¼‰
â””â”€â”€ dependencies.py     # æ¨¡å—ä¾èµ–æ³¨å…¥
```

## æ•°æ®æ¨¡å‹

### Certificate æ¨¡å‹ï¼ˆå…±äº«æ¨¡å‹ï¼‰
```python
class Certificate(Base):
    __tablename__ = 'certificates'
    
    id = Column(BigInteger, primary_key=True, index=True)
    name = Column(String(200), nullable=False)        # è¯ä¹¦åç§°
    issuer = Column(String(200), nullable=True)       # å‘è¯æœºæ„
    serial = Column(String(200), unique=True, nullable=False)  # è¯ä¹¦åºåˆ—å·
    description = Column(Text, nullable=True)         # è¯ä¹¦æè¿°ï¼ˆå¾…æ‰©å±•ï¼‰
    
    # å¾…æ‰©å±•å­—æ®µï¼š
    # issue_date = Column(Date)                       # å‘è¯æ—¥æœŸ
    # expire_date = Column(Date)                      # è¿‡æœŸæ—¥æœŸ
    # certificate_type = Column(String(50))           # è¯ä¹¦ç±»å‹
    # file_url = Column(String(500))                  # è¯ä¹¦æ–‡ä»¶URL
    # verification_url = Column(String(500))          # éªŒè¯æŸ¥è¯¢URL
```

### æ”¯æŒçš„è¯ä¹¦ç±»å‹
- **æœ‰æœºè®¤è¯è¯ä¹¦** - æœ‰æœºå†œäº§å“è®¤è¯
- **ç»¿è‰²é£Ÿå“è®¤è¯** - ç»¿è‰²é£Ÿå“æ ‡è¯†è®¤è¯
- **æ— å…¬å®³è®¤è¯** - æ— å…¬å®³å†œäº§å“è®¤è¯
- **åœ°ç†æ ‡å¿—è®¤è¯** - å†œäº§å“åœ°ç†æ ‡å¿—è®¤è¯
- **è´¨æ£€æŠ¥å‘Š** - ç¬¬ä¸‰æ–¹æ£€æµ‹æœºæ„è´¨æ£€æŠ¥å‘Š
- **ISOè®¤è¯** - ISOè´¨é‡ç®¡ç†ä½“ç³»è®¤è¯

## API æ¥å£

### è¯ä¹¦ç®¡ç†æ¥å£

#### 1. åˆ›å»ºè¯ä¹¦
```http
POST /api/v1/quality-control/certificates
Content-Type: application/json

{
    "name": "æœ‰æœºè®¤è¯è¯ä¹¦",
    "issuer": "ä¸­å›½æœ‰æœºäº§å“è®¤è¯ä¸­å¿ƒ",
    "serial": "COFCC-R-2024-001234",
    "description": "æœ‰æœºè”¬èœè®¤è¯ï¼Œæœ‰æ•ˆæœŸè‡³2025å¹´12æœˆ"
}
```

#### 2. è·å–è¯ä¹¦åˆ—è¡¨
```http
GET /api/v1/quality-control/certificates?skip=0&limit=100
```

#### 3. è·å–è¯ä¹¦è¯¦æƒ…
```http
GET /api/v1/quality-control/certificates/{certificate_id}
```

#### 4. åˆ é™¤è¯ä¹¦
```http
DELETE /api/v1/quality-control/certificates/{certificate_id}
```

## ä¸šåŠ¡é€»è¾‘

### è¯ä¹¦ç®¡ç†æµç¨‹
1. **è¯ä¹¦ä¸Šä¼ ** - ä¾›åº”å•†æˆ–ç®¡ç†å‘˜ä¸Šä¼ è´¨é‡è®¤è¯è¯ä¹¦
2. **ä¿¡æ¯å½•å…¥** - å½•å…¥è¯ä¹¦åŸºæœ¬ä¿¡æ¯ï¼ˆåç§°ã€å‘è¯æœºæ„ã€åºåˆ—å·ç­‰ï¼‰
3. **çœŸå®æ€§éªŒè¯** - é€šè¿‡å‘è¯æœºæ„å®˜ç½‘éªŒè¯è¯ä¹¦çœŸå®æ€§ï¼ˆåæœŸåŠŸèƒ½ï¼‰
4. **å…³è”å•†å“** - å°†è¯ä¹¦å…³è”åˆ°å¯¹åº”çš„å•†å“æˆ–æ‰¹æ¬¡
5. **æ¶ˆè´¹è€…å±•ç¤º** - åœ¨å•†å“é¡µé¢å±•ç¤ºç›¸å…³è®¤è¯è¯ä¹¦

### è´¨é‡ä¿è¯ä½“ç³»
1. **è®¤è¯å±‚çº§**
   - åŸºç¡€è®¤è¯ï¼šæ— å…¬å®³å†œäº§å“è®¤è¯
   - ä¸­çº§è®¤è¯ï¼šç»¿è‰²é£Ÿå“è®¤è¯
   - é«˜çº§è®¤è¯ï¼šæœ‰æœºäº§å“è®¤è¯

2. **æ£€æµ‹æŠ¥å‘Šç®¡ç†**
   - å†œè¯æ®‹ç•™æ£€æµ‹æŠ¥å‘Š
   - é‡é‡‘å±æ£€æµ‹æŠ¥å‘Š
   - å¾®ç”Ÿç‰©æ£€æµ‹æŠ¥å‘Š
   - è¥å…»æˆåˆ†æ£€æµ‹æŠ¥å‘Š

3. **åˆè§„æ€§æ£€æŸ¥**
   - è¯ä¹¦æœ‰æ•ˆæœŸéªŒè¯
   - å‘è¯æœºæ„æƒå¨æ€§éªŒè¯
   - é€‚ç”¨èŒƒå›´éªŒè¯

## æ€§èƒ½ä¼˜åŒ–

### ç¼“å­˜ç­–ç•¥
- **è¯ä¹¦åˆ—è¡¨ç¼“å­˜** - ä½¿ç”¨Redisç¼“å­˜çƒ­é—¨è¯ä¹¦åˆ—è¡¨
- **è¯ä¹¦è¯¦æƒ…ç¼“å­˜** - ç¼“å­˜ç»å¸¸æŸ¥è¯¢çš„è¯ä¹¦è¯¦æƒ…
- **éªŒè¯ç»“æœç¼“å­˜** - ç¼“å­˜è¯ä¹¦éªŒè¯ç»“æœï¼Œé¿å…é‡å¤éªŒè¯

### æŸ¥è¯¢ä¼˜åŒ–
- **ç´¢å¼•ä¼˜åŒ–** - åœ¨è¯ä¹¦åºåˆ—å·å­—æ®µå»ºç«‹å”¯ä¸€ç´¢å¼•
- **åˆ†é¡µæŸ¥è¯¢** - æ”¯æŒå¤§é‡è¯ä¹¦çš„åˆ†é¡µæŸ¥è¯¢
- **å…³è”æŸ¥è¯¢** - ä¼˜åŒ–è¯ä¹¦ä¸å•†å“çš„å…³è”æŸ¥è¯¢æ€§èƒ½

## é›†æˆæ¥å£

### ä¸å…¶ä»–æ¨¡å—çš„é›†æˆ

#### 1. æ‰¹æ¬¡æº¯æºæ¨¡å—
```python
# è·å–æ‰¹æ¬¡ç›¸å…³çš„è´¨é‡è¯ä¹¦
async def get_batch_certificates(batch_id: str) -> List[Certificate]:
    # é€šè¿‡æ‰¹æ¬¡IDè·å–å…³è”çš„è´¨é‡è¯ä¹¦
    pass
```

#### 2. å•†å“ç®¡ç†æ¨¡å—
```python
# è·å–å•†å“ç›¸å…³çš„è´¨é‡è¯ä¹¦
async def get_product_certificates(product_id: int) -> List[Certificate]:
    # é€šè¿‡å•†å“IDè·å–å…³è”çš„è´¨é‡è¯ä¹¦
    pass
```

#### 3. ä¾›åº”å•†ç®¡ç†æ¨¡å—
```python
# è·å–ä¾›åº”å•†çš„èµ„è´¨è¯ä¹¦
async def get_supplier_certificates(supplier_id: int) -> List[Certificate]:
    # é€šè¿‡ä¾›åº”å•†IDè·å–ç›¸å…³çš„èµ„è´¨è¯ä¹¦
    pass
```

## éƒ¨ç½²é…ç½®

### ç¯å¢ƒå˜é‡
```bash
# è´¨é‡æ§åˆ¶æ¨¡å—é…ç½®
QUALITY_CONTROL_ENABLED=true

# è¯ä¹¦æ–‡ä»¶å­˜å‚¨é…ç½®
CERTIFICATE_STORAGE_TYPE=oss  # local/oss/s3
CERTIFICATE_STORAGE_URL=https://certificates.example.com

# ç¬¬ä¸‰æ–¹éªŒè¯æ¥å£é…ç½®ï¼ˆåæœŸåŠŸèƒ½ï¼‰
COFCC_VERIFY_URL=https://www.ofcc.org.cn/verify
GREEN_FOOD_VERIFY_URL=https://www.greenfood.org.cn/verify
```

### æ•°æ®åº“é…ç½®
```sql
-- è¯ä¹¦è¡¨ç´¢å¼•ä¼˜åŒ–
CREATE INDEX idx_certificates_serial ON certificates(serial);
CREATE INDEX idx_certificates_issuer ON certificates(issuer);
CREATE INDEX idx_certificates_name ON certificates(name);
```

## ç›¸å…³æ–‡æ¡£

### æ¶æ„æ–‡æ¡£
- [ç³»ç»Ÿæ¶æ„æ€»è§ˆ](../../architecture/overview.md)
- [APIè®¾è®¡è§„èŒƒ](../../standards/api-standards.md)
- [æ•°æ®æ¨¡å‹è§„èŒƒ](../../standards/database-standards.md)

### å¼€å‘æ–‡æ¡£
- [å¼€å‘è§„èŒƒ](../../development/development-standards.md)
- [æµ‹è¯•æŒ‡å—](../../development/testing.md)
- [éƒ¨ç½²æŒ‡å—](../../operations/deployment.md)

### éœ€æ±‚æ–‡æ¡£
- [ä¸šåŠ¡éœ€æ±‚](../../requirements/business.md)
- [åŠŸèƒ½éœ€æ±‚](../../requirements/functional.md)

### ç›¸å…³æ¨¡å—
- [æ‰¹æ¬¡æº¯æºæ¨¡å—](../batch-traceability/overview.md)
- [å•†å“ç®¡ç†æ¨¡å—](../product-catalog/overview.md)
- [ä¾›åº”å•†ç®¡ç†æ¨¡å—](../supplier-management/overview.md)