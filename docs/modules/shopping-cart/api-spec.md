# è´­ç‰©è½¦æ¨¡å— - APIè§„èŒƒæ–‡æ¡£

ğŸ“… **åˆ›å»ºæ—¥æœŸ**: 2025-09-16  
ğŸ‘¤ **è®¾è®¡è€…**: åç«¯æ¶æ„å¸ˆ  
âœ… **çŠ¶æ€**: è®¾è®¡ä¸­  
ğŸ”„ **æœ€åæ›´æ–°**: 2025-09-16  
ğŸ“‹ **ç‰ˆæœ¬**: v1.0  

## APIæ¦‚è§ˆ

### åŸºç¡€ä¿¡æ¯
- **æ¨¡å—å**: shopping-cart  
- **APIå‰ç¼€**: `/api/v1/cart/`
- **è®¤è¯æ–¹å¼**: JWT Bearer Token
- **æ•°æ®æ ¼å¼**: JSON
- **å­—ç¬¦ç¼–ç **: UTF-8

### è®¾è®¡åŸåˆ™
- **RESTfulè®¾è®¡**: éµå¾ªRESTæ¶æ„é£æ ¼
- **å¹‚ç­‰æ€§ä¿è¯**: PUT/DELETEæ“ä½œæ”¯æŒå¹‚ç­‰
- **ç»Ÿä¸€å“åº”æ ¼å¼**: æˆåŠŸ/é”™è¯¯å“åº”æ ¼å¼ç»Ÿä¸€
- **ç‰ˆæœ¬å…¼å®¹æ€§**: å‘å‰å…¼å®¹ï¼Œæ¸è¿›å¼å‡çº§

### ç«¯ç‚¹åˆ—è¡¨

| æ–¹æ³• | è·¯å¾„ | åŠŸèƒ½æè¿° | çŠ¶æ€ |
|------|------|----------|------|
| POST | `/api/v1/cart/items` | æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦ | å¾…å®ç° |
| GET | `/api/v1/cart` | è·å–è´­ç‰©è½¦å†…å®¹ | å¾…å®ç° |
| PUT | `/api/v1/cart/items/{item_id}` | æ›´æ–°å•†å“æ•°é‡ | å¾…å®ç° |
| DELETE | `/api/v1/cart/items/{item_id}` | åˆ é™¤å•ä¸ªå•†å“ | å¾…å®ç° |
| DELETE | `/api/v1/cart/items` | æ‰¹é‡åˆ é™¤å•†å“ | å¾…å®ç° |
| DELETE | `/api/v1/cart` | æ¸…ç©ºè´­ç‰©è½¦ | å¾…å®ç° |

## é€šç”¨è§„èŒƒ

### è¯·æ±‚å¤´è§„èŒƒ
```http
Content-Type: application/json
Authorization: Bearer {jwt_token}
Accept: application/json
User-Agent: {client_info}
```

### ç»Ÿä¸€å“åº”æ ¼å¼

#### æˆåŠŸå“åº”
```json
{
    "success": true,
    "data": {
        // å…·ä½“ä¸šåŠ¡æ•°æ®
    },
    "message": "æ“ä½œæˆåŠŸ",
    "timestamp": "2025-09-16T10:30:00Z",
    "request_id": "req_12345678"
}
```

#### é”™è¯¯å“åº”
```json
{
    "success": false,
    "error": {
        "code": "CART_ERROR_001",
        "message": "åº“å­˜ä¸è¶³",
        "details": {
            "sku_id": 12345,
            "requested": 10,
            "available": 5
        }
    },
    "timestamp": "2025-09-16T10:30:00Z",
    "request_id": "req_12345678"
}
```

### HTTPçŠ¶æ€ç è§„èŒƒ
| çŠ¶æ€ç  | æè¿° | ä½¿ç”¨åœºæ™¯ |
|--------|------|----------|
| 200 | OK | æ“ä½œæˆåŠŸ |
| 201 | Created | èµ„æºåˆ›å»ºæˆåŠŸ |
| 400 | Bad Request | è¯·æ±‚å‚æ•°é”™è¯¯ |
| 401 | Unauthorized | ç”¨æˆ·æœªè®¤è¯ |
| 403 | Forbidden | æƒé™ä¸è¶³ |
| 404 | Not Found | èµ„æºä¸å­˜åœ¨ |
| 409 | Conflict | èµ„æºå†²çª |
| 429 | Too Many Requests | è¯·æ±‚è¿‡äºé¢‘ç¹ |
| 500 | Internal Server Error | æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ |

## è¯¦ç»†APIè§„èŒƒ

### 1. æ·»åŠ å•†å“åˆ°è´­ç‰©è½¦

#### ç«¯ç‚¹ä¿¡æ¯
```
POST /api/v1/cart/items
```

#### åŠŸèƒ½æè¿°
å°†æŒ‡å®šçš„å•†å“æ·»åŠ åˆ°å½“å‰ç”¨æˆ·çš„è´­ç‰©è½¦ä¸­ï¼Œå¦‚æœå•†å“å·²å­˜åœ¨åˆ™å¢åŠ æ•°é‡ã€‚

#### è¯·æ±‚å‚æ•°
```json
{
    "sku_id": 12345,
    "quantity": 2
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | æè¿° | éªŒè¯è§„åˆ™ |
|------|------|------|------|----------|
| sku_id | integer | æ˜¯ | å•†å“SKU ID | > 0 |
| quantity | integer | æ˜¯ | å•†å“æ•°é‡ | 1-999 |

#### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº” (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "total_items": 3,
        "total_quantity": 5,
        "total_amount": 299.99,
        "items": [
            {
                "item_id": 456,
                "sku_id": 12345,
                "product_name": "iPhone 15 Pro",
                "unit_price": 99.99,
                "quantity": 2,
                "subtotal": 199.98,
                "added_at": "2025-09-16T10:30:00Z"
            }
        ],
        "updated_at": "2025-09-16T10:30:00Z"
    }
}
```

**é”™è¯¯å“åº” (400 - åº“å­˜ä¸è¶³)**
```json
{
    "success": false,
    "error": {
        "code": "CART_002",
        "message": "å•†å“åº“å­˜ä¸è¶³",
        "details": {
            "sku_id": 12345,
            "requested_quantity": 10,
            "available_stock": 5
        }
    }
}
```

#### ä¸šåŠ¡è§„åˆ™
1. ç”¨æˆ·å¿…é¡»å·²ç™»å½•
2. å•†å“å¿…é¡»å¤„äºä¸Šæ¶çŠ¶æ€
3. åº“å­˜å¿…é¡»å……è¶³
4. è´­ç‰©è½¦å•†å“ç§ç±»ä¸è¶…è¿‡50ä¸ª
5. å•ä¸ªå•†å“æ•°é‡ä¸è¶…è¿‡999ä¸ª

### 2. è·å–è´­ç‰©è½¦å†…å®¹

#### ç«¯ç‚¹ä¿¡æ¯
```
GET /api/v1/cart
```

#### åŠŸèƒ½æè¿°
è·å–å½“å‰ç”¨æˆ·è´­ç‰©è½¦çš„å®Œæ•´å†…å®¹ï¼ŒåŒ…æ‹¬å•†å“è¯¦æƒ…å’Œä»·æ ¼è®¡ç®—ã€‚

#### è¯·æ±‚å‚æ•°
æ— 

#### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº” (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "user_id": 789,
        "total_items": 2,
        "total_quantity": 4,
        "total_amount": 399.98,
        "items": [
            {
                "item_id": 456,
                "sku_id": 12345,
                "product_name": "iPhone 15 Pro",
                "product_image": "https://cdn.example.com/iphone15.jpg",
                "unit_price": 99.99,
                "quantity": 2,
                "subtotal": 199.98,
                "stock_status": "in_stock",
                "available_stock": 100,
                "added_at": "2025-09-16T10:30:00Z"
            },
            {
                "item_id": 457,
                "sku_id": 12346,
                "product_name": "AirPods Pro",
                "product_image": "https://cdn.example.com/airpods.jpg",
                "unit_price": 199.99,
                "quantity": 1,
                "subtotal": 199.99,
                "stock_status": "low_stock",
                "available_stock": 3,
                "added_at": "2025-09-16T11:00:00Z"
            }
        ],
        "created_at": "2025-09-16T10:30:00Z",
        "updated_at": "2025-09-16T11:00:00Z"
    }
}
```

**ç©ºè´­ç‰©è½¦ (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "user_id": 789,
        "total_items": 0,
        "total_quantity": 0,
        "total_amount": 0.00,
        "items": [],
        "created_at": "2025-09-16T10:30:00Z",
        "updated_at": "2025-09-16T10:30:00Z"
    }
}
```

### 3. æ›´æ–°å•†å“æ•°é‡

#### ç«¯ç‚¹ä¿¡æ¯
```
PUT /api/v1/cart/items/{item_id}
```

#### åŠŸèƒ½æè¿°
æ›´æ–°è´­ç‰©è½¦ä¸­æŒ‡å®šå•†å“çš„æ•°é‡ã€‚

#### è·¯å¾„å‚æ•°
| å‚æ•° | ç±»å‹ | æè¿° |
|------|------|------|
| item_id | integer | è´­ç‰©è½¦å•†å“é¡¹ID |

#### è¯·æ±‚å‚æ•°
```json
{
    "quantity": 5
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | æè¿° | éªŒè¯è§„åˆ™ |
|------|------|------|------|----------|
| quantity | integer | æ˜¯ | æ–°çš„å•†å“æ•°é‡ | 1-999 |

#### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº” (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "total_items": 2,
        "total_quantity": 6,
        "total_amount": 499.95,
        "updated_item": {
            "item_id": 456,
            "sku_id": 12345,
            "quantity": 5,
            "subtotal": 499.95
        },
        "updated_at": "2025-09-16T11:30:00Z"
    }
}
```

**é”™è¯¯å“åº” (400 - åº“å­˜ä¸è¶³)**
```json
{
    "success": false,
    "error": {
        "code": "CART_002",
        "message": "åº“å­˜ä¸è¶³ï¼Œå·²è°ƒæ•´åˆ°æœ€å¤§å¯ç”¨æ•°é‡",
        "details": {
            "item_id": 456,
            "sku_id": 12345,
            "requested_quantity": 10,
            "adjusted_quantity": 5,
            "available_stock": 5
        }
    }
}
```

### 4. åˆ é™¤å•ä¸ªå•†å“

#### ç«¯ç‚¹ä¿¡æ¯
```
DELETE /api/v1/cart/items/{item_id}
```

#### åŠŸèƒ½æè¿°
ä»è´­ç‰©è½¦ä¸­åˆ é™¤æŒ‡å®šçš„å•†å“é¡¹ã€‚

#### è·¯å¾„å‚æ•°
| å‚æ•° | ç±»å‹ | æè¿° |
|------|------|------|
| item_id | integer | è´­ç‰©è½¦å•†å“é¡¹ID |

#### è¯·æ±‚å‚æ•°
æ— 

#### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº” (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "total_items": 1,
        "total_quantity": 1,
        "total_amount": 199.99,
        "deleted_item": {
            "item_id": 456,
            "sku_id": 12345,
            "product_name": "iPhone 15 Pro"
        },
        "updated_at": "2025-09-16T12:00:00Z"
    }
}
```

**é”™è¯¯å“åº” (404)**
```json
{
    "success": false,
    "error": {
        "code": "CART_004",
        "message": "è´­ç‰©è½¦å•†å“é¡¹ä¸å­˜åœ¨",
        "details": {
            "item_id": 456
        }
    }
}
```

### 5. æ‰¹é‡åˆ é™¤å•†å“

#### ç«¯ç‚¹ä¿¡æ¯
```
DELETE /api/v1/cart/items
```

#### åŠŸèƒ½æè¿°
æ‰¹é‡åˆ é™¤è´­ç‰©è½¦ä¸­çš„å¤šä¸ªå•†å“é¡¹ã€‚

#### è¯·æ±‚å‚æ•°
```json
{
    "item_ids": [456, 457, 458]
}
```

| å­—æ®µ | ç±»å‹ | å¿…å¡« | æè¿° | éªŒè¯è§„åˆ™ |
|------|------|------|------|----------|
| item_ids | array | æ˜¯ | å•†å“é¡¹IDåˆ—è¡¨ | æ•°ç»„é•¿åº¦1-50 |

#### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº” (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "total_items": 0,
        "total_quantity": 0,
        "total_amount": 0.00,
        "deleted_count": 3,
        "deleted_items": [
            {"item_id": 456, "sku_id": 12345},
            {"item_id": 457, "sku_id": 12346},
            {"item_id": 458, "sku_id": 12347}
        ],
        "updated_at": "2025-09-16T12:30:00Z"
    }
}
```

### 6. æ¸…ç©ºè´­ç‰©è½¦

#### ç«¯ç‚¹ä¿¡æ¯
```
DELETE /api/v1/cart
```

#### åŠŸèƒ½æè¿°
æ¸…ç©ºå½“å‰ç”¨æˆ·çš„æ•´ä¸ªè´­ç‰©è½¦ã€‚

#### è¯·æ±‚å‚æ•°
æ— 

#### å“åº”ç¤ºä¾‹

**æˆåŠŸå“åº” (200)**
```json
{
    "success": true,
    "data": {
        "cart_id": 123,
        "total_items": 0,
        "total_quantity": 0,
        "total_amount": 0.00,
        "cleared_count": 5,
        "updated_at": "2025-09-16T13:00:00Z"
    },
    "message": "è´­ç‰©è½¦å·²æ¸…ç©º"
}
```

## é”™è¯¯ç å®šä¹‰

| é”™è¯¯ç  | HTTPçŠ¶æ€ç  | é”™è¯¯æè¿° | è§£å†³æ–¹æ¡ˆ |
|--------|------------|----------|----------|
| CART_001 | 400 | è¯·æ±‚å‚æ•°éªŒè¯å¤±è´¥ | æ£€æŸ¥å‚æ•°æ ¼å¼å’Œå–å€¼èŒƒå›´ |
| CART_002 | 400 | å•†å“åº“å­˜ä¸è¶³ | è°ƒæ•´å•†å“æ•°é‡æˆ–é€‰æ‹©å…¶ä»–å•†å“ |
| CART_003 | 400 | è´­ç‰©è½¦å•†å“æ•°é‡è¶…é™ | è´­ç‰©è½¦æœ€å¤š50ç§å•†å“ |
| CART_004 | 404 | è´­ç‰©è½¦å•†å“é¡¹ä¸å­˜åœ¨ | ç¡®è®¤å•†å“é¡¹IDæ­£ç¡®æ€§ |
| CART_005 | 404 | å•†å“ä¸å­˜åœ¨æˆ–å·²ä¸‹æ¶ | é€‰æ‹©å…¶ä»–åœ¨å”®å•†å“ |
| CART_006 | 409 | å•†å“å·²åœ¨è´­ç‰©è½¦ä¸­ | ä½¿ç”¨æ›´æ–°æ•°é‡æ¥å£ |
| CART_007 | 429 | æ“ä½œè¿‡äºé¢‘ç¹ | ç¨åé‡è¯• |
| CART_008 | 500 | ç¼“å­˜æœåŠ¡å¼‚å¸¸ | ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»å®¢æœ |
| CART_009 | 500 | æ•°æ®åº“æœåŠ¡å¼‚å¸¸ | ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·è”ç³»å®¢æœ |

## æ•°æ®æ¨¡å‹å®šä¹‰

### CartResponse
```json
{
    "cart_id": "integer",
    "user_id": "integer", 
    "total_items": "integer",
    "total_quantity": "integer",
    "total_amount": "decimal(10,2)",
    "items": "array[CartItem]",
    "created_at": "datetime",
    "updated_at": "datetime"
}
```

### CartItem
```json
{
    "item_id": "integer",
    "sku_id": "integer",
    "product_name": "string",
    "product_image": "string",
    "unit_price": "decimal(10,2)",
    "quantity": "integer",
    "subtotal": "decimal(10,2)",
    "stock_status": "enum[in_stock, low_stock, out_of_stock]",
    "available_stock": "integer",
    "added_at": "datetime"
}
```

### AddItemRequest  
```json
{
    "sku_id": "integer",
    "quantity": "integer"
}
```

### UpdateQuantityRequest
```json
{
    "quantity": "integer"
}
```

### BatchDeleteRequest
```json
{
    "item_ids": "array[integer]"
}
```

## æ€§èƒ½è€ƒè™‘

### ç¼“å­˜ç­–ç•¥
- **è´­ç‰©è½¦æ•°æ®**: Redisç¼“å­˜ï¼ŒTTL 1å°æ—¶
- **å•†å“ä¿¡æ¯**: æœ¬åœ°ç¼“å­˜ï¼ŒTTL 10åˆ†é’Ÿ
- **åº“å­˜æ•°æ®**: å®æ—¶æŸ¥è¯¢ï¼Œä¸ç¼“å­˜

### é™æµç­–ç•¥
- **æ·»åŠ å•†å“**: æ¯ç”¨æˆ·æ¯ç§’æœ€å¤š5æ¬¡
- **æŸ¥è¯¢è´­ç‰©è½¦**: æ¯ç”¨æˆ·æ¯ç§’æœ€å¤š10æ¬¡
- **æ‰¹é‡æ“ä½œ**: æ¯ç”¨æˆ·æ¯åˆ†é’Ÿæœ€å¤š10æ¬¡

### å¹¶å‘å¤„ç†
- **ä¹è§‚é”**: ä½¿ç”¨versionå­—æ®µé˜²æ­¢å¹¶å‘å†²çª
- **åˆ†å¸ƒå¼é”**: Redisé”ä¿æŠ¤åº“å­˜éªŒè¯
- **å¹‚ç­‰æ€§**: PUT/DELETEæ“ä½œæ”¯æŒé‡è¯•

## æµ‹è¯•ç”¨ä¾‹

### åŠŸèƒ½æµ‹è¯•
1. **æ­£å¸¸æµç¨‹æµ‹è¯•**: æ·»åŠ â†’æŸ¥çœ‹â†’ä¿®æ”¹â†’åˆ é™¤
2. **è¾¹ç•Œå€¼æµ‹è¯•**: æ•°é‡é™åˆ¶ã€å•†å“æ•°é™åˆ¶
3. **å¼‚å¸¸åœºæ™¯æµ‹è¯•**: åº“å­˜ä¸è¶³ã€å•†å“ä¸‹æ¶
4. **å¹¶å‘æµ‹è¯•**: å¤šç”¨æˆ·åŒæ—¶æ“ä½œ

### æ€§èƒ½æµ‹è¯•
1. **å“åº”æ—¶é—´**: 95%è¯·æ±‚ < 100ms
2. **å¹¶å‘èƒ½åŠ›**: 1000å¹¶å‘ç”¨æˆ·
3. **ç¼“å­˜å‘½ä¸­ç‡**: > 85%

## ç‰ˆæœ¬å˜æ›´è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ | å˜æ›´å†…å®¹ | å˜æ›´äºº |
|------|------|----------|--------|
| v1.0 | 2025-09-16 | åˆå§‹APIè§„èŒƒè®¾è®¡ | åç«¯æ¶æ„å¸ˆ |
